/*--------------------------------*/
/* r2mainy.pc                      */
/*--------------------------------*/
/* SCCS ID keyword, do not remove */
/* static char *sccsid = "@(#)r2mainy.pc	1.12 02/06/07"; */
static char *sccsid = "$Workfile:   r2mainy.pc  $ $Revision:   2.4  $ $Modtime:   Sep 30 2008 16:06:42  $";

#include <stdio.h>
#include <string.h>

#define SUCCESS      0
#define FAIL         1
#define FATAL        2

EXEC SQL BEGIN DECLARE SECTION;

int tmp_he_id[100];
int tmp_loop;
int i_next_seq;
VARCHAR recal_option[2];
extern VARCHAR full_date[19];
VARCHAR standard_xsp[5];
VARCHAR reverse_xsp[5];
double strtoldtp;
double strtollocl;
double endtoldtp;
double endtollocl;
extern VARCHAR uid[31];
extern VARCHAR pwd[31];
extern int rmms_flag;
extern VARCHAR idxmsg[60];
extern short idxmsg_i;
extern char linkcode[10];
extern long int run_num;
extern long int run_stat;
extern long int num_runs;
extern long int tot_run;
extern short tot_run_i;
extern long int tot_err;
extern long int tot_ph2;
extern long int tot_at_err;
extern long int icode;
extern long int newerr_1;
extern long int newerr_2;
extern long int newerr_3;
extern long int new_sect;
extern long int newsec_err;
extern long int cur_run_stat;
extern long int cnt_good_itm_2;
extern VARCHAR tab_exist_msg[60];
extern VARCHAR tab_name[32];
extern VARCHAR date_time[31];
long int A_cards=0;
short A_cards_i;
long int B_cards=0;
short B_cards_i;
long int C_cards=0;
short C_cards_i;
long int Z_cards=0;
short Z_cards_i;

extern char   sqlerrmsg[512];
VARCHAR ins_sqlerrmsg[512];
extern size_t buf_len, msg_len;

  EXEC SQL declare hhinv_temp_7883 table
      (he_id     number(8)
      ,max_chain number);

  EXEC SQL declare sctdtail table
      (sct_id  number(8)
      ,date_fn date);

  EXEC SQL declare road_sect_ora table
      (rse_he_id                   number(8)
      ,rse_unique                  varchar2(20)
      ,rse_admin_unit              number(8)
      ,rse_type                    varchar2(1)
      ,rse_gty_group_type          varchar2(4)
      ,rse_group                   varchar2(20)
      ,rse_sys_flag                varchar2(1)
      ,rse_agency                  varchar2(4)
      ,rse_linkcode                varchar2(6)
      ,rse_sect_no                 varchar2(5)
      ,rse_road_number             varchar2(5)
      ,rse_start_date              date
      ,rse_end_date                date
      ,rse_descr                   varchar2(80)
      ,rse_adoption_status         varchar2(1)
      ,rse_alias                   number(8)
      ,rse_bh_hier_code            varchar2(3)
      ,rse_carriageway_type        varchar2(1)
      ,rse_class_index             varchar2(6)
      ,rse_coord_flag              varchar2(1)
      ,rse_date_adopted            date
      ,rse_date_opened             date
      ,rse_engineering_difficulty  varchar2(2)
      ,rse_footway_category        varchar2(1)
      ,rse_gis_mapid               number(8)
      ,rse_gis_mslink              number(8)
      ,rse_gradient                number(2)
      ,rse_hgv_percent             number(4,1)
      ,rse_int_code                varchar2(4)
      ,rse_last_inspected          date
      ,rse_last_surveyed           date
      ,rse_length                  number(9,3)
      ,rse_maint_category          varchar2(2)
      ,rse_max_chain               number
      ,rse_network_direction       varchar2(2)
      ,rse_nla_type                varchar2(1)
      ,rse_number_of_lanes         number(1)
      ,rse_pus_node_id_end         varchar2(6)
      ,rse_pus_node_id_st          varchar2(6)
      ,rse_record_invent_rev       varchar2(1)
      ,rse_ref_coat_flag           varchar2(1)
      ,rse_reinstatement_category  varchar2(2)
      ,rse_road_category           varchar2(1)
      ,rse_road_environment        varchar2(1)
      ,rse_road_type               varchar2(2)
      ,rse_scl_sect_class          varchar2(2)
      ,rse_search_group_no         number(3)
      ,rse_seq_signif              varchar2(1)
      ,rse_shared_items            varchar2(1)
      ,rse_skid_res                number(4)
      ,rse_speed_limit             number(2)
      ,rse_status                  varchar2(1)
      ,rse_traffic_sensitivity     varchar2(2)
      ,rse_veh_per_day             number(6)
      ,rse_begin_mp                number(7,3)
      ,rse_cnt_code                number(4)
      ,rse_couplet_id              number(3)
      ,rse_end_mp                  number(7,3)
      ,rse_gov_level               varchar2(2)
      ,rse_max_mp                  number(7,3)
      ,rse_prefix                  varchar2(2)
      ,rse_route                   number(4)
      ,rse_suffix                  varchar2(2));

  EXEC SQL DECLARE HHINV_LOAD_2 TABLE
      (rec_seq_no        number(8),
       sect_hdr_seq_no   number(8),
       he_id             number(8,0),
       linkcode          varchar2(10),
       section_code      varchar2(5),
       inv_code          varchar2(4),
       st_chain          number,
       end_chain         number,
       road_characteristic varchar2(1),
       hhinv_survey_direction varchar2(1),
       survey_length      number(6),
       survey_tolerance   number(6),
       sub_section_length number(6),
       full_partial_ind   varchar2(1),
       peo_invent_by_id  number(8,0) ,
       invent_date       date,
       scl_class         varchar2(2),
       x_sect            varchar2(4),
       error_msg         varchar2(4000),
       error_flg         varchar2(1),
       hhfld1            varchar2(500),
       hhattr1           varchar2(32),
       hhfld2            varchar2(500),
       hhattr2           varchar2(32),
       hhfld3            varchar2(500),
       hhattr3           varchar2(32),
       hhfld4            varchar2(500),
       hhattr4           varchar2(32),
       hhfld5            varchar2(500),
       hhattr5           varchar2(32),
       hhfld6            varchar2(500),
       hhattr6           varchar2(32),
       hhfld7            varchar2(500),
       hhattr7           varchar2(32),
       hhfld8            varchar2(500),
       hhattr8           varchar2(32),
       hhfld9            varchar2(500),
       hhattr9           varchar2(32),
       hhfld10           varchar2(500),
       hhattr10          varchar2(32),
       hhfld11           varchar2(500),
       hhattr11          varchar2(32),
       hhfld12           varchar2(500),
       hhattr12          varchar2(32),
       hhfld13           varchar2(500),
       hhattr13          varchar2(32),
       hhfld14           varchar2(500),
       hhattr14          varchar2(32),
       hhfld15           varchar2(500),
       hhattr15          varchar2(32),
       hhfld16           varchar2(500),
       hhattr16          varchar2(32),
       hhfld17           varchar2(500),
       hhattr17          varchar2(32),
       hhfld18           varchar2(500),
       hhattr18          varchar2(32),
       hhfld19           varchar2(500),
       hhattr19          varchar2(32),
       hhfld20           varchar2(500),
       hhattr20          varchar2(32),
       hhfld21           varchar2(500),
       hhattr21          varchar2(32),
       hhfld22           varchar2(500),
       hhattr22          varchar2(32),
       hhfld23           varchar2(500),
       hhattr23          varchar2(32),
       hhfld24           varchar2(500),
       hhattr24          varchar2(32),
       hhfld25           varchar2(500),
       hhattr25          varchar2(32),
       hhfld26           varchar2(500),
       hhattr26          varchar2(32),
       hhfld27           varchar2(500),
       hhattr27          varchar2(32),
       hhfld28           varchar2(500),
       hhattr28          varchar2(32),
       hhfld29           varchar2(500),
       hhattr29          varchar2(32),
       hhfld30           varchar2(500),
       hhattr30          varchar2(32),
       hhfld31           varchar2(500),
       hhattr31          varchar2(32),
       hhfld32           varchar2(500),
       hhattr32          varchar2(32),
       hhfld33           varchar2(500),
       hhattr33          varchar2(32),
       hhfld34           varchar2(500),
       hhattr34          varchar2(32),
       hhfld35           varchar2(500),
       hhattr35          varchar2(32),
       hhfld36           varchar2(500),
       hhattr36          varchar2(32),
       hhfld37           varchar2(500),
       hhattr37          varchar2(32),
       hhfld38           varchar2(500),
       hhattr38          varchar2(32),
       hhfld39           varchar2(500),
       hhattr39          varchar2(32),
       hhfld40           varchar2(500),
       hhattr40          varchar2(32),
       hhfld41           varchar2(500),
       hhattr41          varchar2(32),
       hhfld42           varchar2(500),
       hhattr42          varchar2(32),
       hhfld43           varchar2(500),
       hhattr43          varchar2(32),
       hhfld44           varchar2(500),
       hhattr44          varchar2(32),
       hhfld45           varchar2(500),
       hhattr45          varchar2(32),
       hhfld46           varchar2(500),
       hhattr46          varchar2(32),
       hhfld47           varchar2(500),
       hhattr47          varchar2(32),
       hhfld48           varchar2(500),
       hhattr48          varchar2(32),
       hhfld49           varchar2(500),
       hhattr49          varchar2(32),
       hhfld50           varchar2(500),
       hhattr50          varchar2(32),
       hhfld51           varchar2(500),
       hhattr51          varchar2(32),
       hhfld52           varchar2(500),
       hhattr52          varchar2(32),
       hhfld53           varchar2(500),
       hhattr53          varchar2(32),
       hhfld54           varchar2(500),
       hhattr54          varchar2(32),
       hhfld55           varchar2(500),
       hhattr55          varchar2(32),
       hhfld56           varchar2(500),
       hhattr56          varchar2(32),
       hhfld57           varchar2(500),
       hhattr57          varchar2(32),
       hhfld58           varchar2(500),
       hhattr58          varchar2(32),
       hhfld59           varchar2(500),
       hhattr59          varchar2(32),
       hhfld60           varchar2(500),
       hhattr60          varchar2(32),
       hhfld61           varchar2(500),
       hhattr61          varchar2(32),
       hhfld62           varchar2(500),
       hhattr62          varchar2(32),
       hhfld63           varchar2(500),
       hhattr63          varchar2(32),
       hhfld64           varchar2(500),
       hhattr64          varchar2(32),
       hhfld65           varchar2(500),
       hhattr65          varchar2(32),
       hhfld66           varchar2(500),
       hhattr66          varchar2(32),
       hhfld67           varchar2(500),
       hhattr67          varchar2(32),
       hhfld68           varchar2(500),
       hhattr68          varchar2(32),
       hhfld69           varchar2(500),
       hhattr69          varchar2(32),
       hhfld70           varchar2(500),
       hhattr70          varchar2(32),
       hhfld71           varchar2(500),
       hhattr71          varchar2(32),
       hhfld72           varchar2(500),
       hhattr72          varchar2(32),
       hhfld73           varchar2(500),
       hhattr73          varchar2(32),
       hhfld74           varchar2(500),
       hhattr74          varchar2(32),
       hhfld75           varchar2(500),
       hhattr75          varchar2(32),
       hhinv_ity_sys_flag varchar2(1) );

  EXEC SQL DECLARE HHINV_LOAD_3 TABLE
      (rec_seq_no            number(8),
       he_id                 number(8,0),
       linkcode              varchar2(10),
       section_code          varchar2(5),
       inv_code              varchar2(4),
       attribute             varchar2(32),
       st_chain              number,
       end_chain             number,
       primary_key           varchar2(50),
       foreign_key           varchar2(50),
       peo_invent_by_id      number(8,0),
       invent_date           date,
       x_sect                varchar2(4),
       value                 varchar2(500),
       error_msg             varchar2(4000),
       error_flg             varchar2(1),
       length                number(6),
       gap                   number(6,2),
       width                 number(6,2),
       height                number(6,2),
       height_2              number(6,2),
       distance              number(7,2),
       angle                 number(6,2),
       no_of_units           number(3),
       power                 number(6),
       type                  varchar2(2),
       class                 varchar2(2),
       material              varchar2(2),
       colour                varchar2(2),
       owner                 varchar2(4),
       method                varchar2(2),
       options               varchar2(2),
       description           varchar2(40),
       id_code               varchar2(8),
       diagram               varchar2(6),
       photo                 varchar2(6),
       note                  varchar2(40),
       instal_date           date,
       itemcode              varchar2(8),
       xtra_char_1           varchar2(20),
       xtra_date_1           date,
       xtra_domain_1         varchar2(2),
       xtra_number_1         number(10,2),
       primary_key           varchar2(50),
       foreign_key           varchar2(50),
       descr                 varchar2(40),        /* Added For NM3 */
       located_by            number(9),           /* Added For NM3 */
       position              number,              /* Added For NM3 */
       x_coord               number,              /* Added For NM3 */
       y_coord               number,              /* Added For NM3 */
       coord_flag            varchar2(1),         /* Added For NM3 */
       inv_ownership         varchar2(4),         /* Added For NM3 */
       lco_lamp_config_id    number(3),           /* Added For NM3 */
       oun_org_id_elec_board number(8),           /* Added For NM3 */
       prov_flag             varchar2(1),         /* Added For NM3 */
       rev_by                varchar2(20),        /* Added For NM3 */
       rev_date              date,                /* Added For NM3 */
       offset                number,              /* Added For NM3 */
       x                     number,              /* Added For NM3 */
       y                     number,              /* Added For NM3 */
       z                     number,              /* Added For NM3 */
       num_attrib16          number,
       num_attrib17          number,
       num_attrib18          number,
       num_attrib19          number,
       num_attrib20          number,
       num_attrib21          number,
       num_attrib22          number,
       num_attrib23          number,
       num_attrib24          number,
       num_attrib25          number,
       chr_attrib26          varchar2(50),
       chr_attrib27          varchar2(50),
       chr_attrib28          varchar2(50),
       chr_attrib29          varchar2(50),
       chr_attrib30          varchar2(50),
       chr_attrib31          varchar2(50),
       chr_attrib32          varchar2(50),
       chr_attrib33          varchar2(50),
       chr_attrib34          varchar2(50),
       chr_attrib35          varchar2(50),
       chr_attrib36          varchar2(50),
       chr_attrib37          varchar2(50),
       chr_attrib38          varchar2(50),
       chr_attrib39          varchar2(50),
       chr_attrib40          varchar2(50),
       chr_attrib41          varchar2(50),
       chr_attrib42          varchar2(50),
       chr_attrib43          varchar2(50),
       chr_attrib44          varchar2(50),
       chr_attrib45          varchar2(50),
       chr_attrib46          varchar2(50),
       chr_attrib47          varchar2(50),
       chr_attrib48          varchar2(50),
       chr_attrib49          varchar2(50),
       chr_attrib50          varchar2(50),
       chr_attrib51          varchar2(50),
       chr_attrib52          varchar2(50),
       chr_attrib53          varchar2(50),
       chr_attrib54          varchar2(50),
       chr_attrib55          varchar2(50),
       chr_attrib56          varchar2(200),
       chr_attrib57          varchar2(200),
       chr_attrib58          varchar2(200),
       chr_attrib59          varchar2(200),
       chr_attrib60          varchar2(200),
       chr_attrib61          varchar2(200),
       chr_attrib62          varchar2(200),
       chr_attrib63          varchar2(200),
       chr_attrib64          varchar2(200),
       chr_attrib65          varchar2(200),
       chr_attrib66          varchar2(500),
       chr_attrib67          varchar2(500),
       chr_attrib68          varchar2(500),
       chr_attrib69          varchar2(500),
       chr_attrib70          varchar2(500),
       chr_attrib71          varchar2(500),
       chr_attrib72          varchar2(500),
       chr_attrib73          varchar2(500),
       chr_attrib74          varchar2(500),
       chr_attrib75          varchar2(500),
       num_attrib76          number,
       num_attrib77          number,
       num_attrib78          number,
       num_attrib79          number,
       num_attrib80          number,
       num_attrib81          number,
       num_attrib82          number,
       num_attrib83          number,
       num_attrib84          number,
       num_attrib85          number,
       date_attrib86         date,
       date_attrib87         date,
       date_attrib88         date,
       date_attrib89         date,
       date_attrib90         date,
       date_attrib91         date,
       date_attrib92         date,
       date_attrib93         date,
       date_attrib94         date,
       date_attrib95         date,
       num_attrib96          number,          /* Added For NM3 */
       num_attrib97          number,          /* Added For NM3 */
       num_attrib98          number,          /* Added For NM3 */
       num_attrib99          number,          /* Added For NM3 */
       num_attrib100         number,          /* Added For NM3 */
       num_attrib101         number,          /* Added For NM3 */
       num_attrib102         number,          /* Added For NM3 */
       num_attrib103         number,          /* Added For NM3 */
       num_attrib104         number,          /* Added For NM3 */
       num_attrib105         number,          /* Added For NM3 */
       num_attrib106         number,          /* Added For NM3 */
       num_attrib107         number,          /* Added For NM3 */
       num_attrib108         number,          /* Added For NM3 */
       num_attrib109         number,          /* Added For NM3 */
       num_attrib110         number,          /* Added For NM3 */
       num_attrib111         number,          /* Added For NM3 */
       num_attrib112         number,          /* Added For NM3 */
       num_attrib113         number,          /* Added For NM3 */
       num_attrib114         number,          /* Added For NM3 */
       num_attrib115         number,          /* Added For NM3 */
       det_xsp               varchar2(4),
       ity_sys_flag          varchar2(1));

  int r_inv_he_id[100]
     ,inv_he_id
     ,r_inv_invent_date[100]
     ,inv_invent_date
    ;
  VARCHAR r_inv_inv_type[100][5];
  VARCHAR inv_inv_type[5];
EXEC SQL END DECLARE SECTION;

#define SQLCA_STORAGE_CLASS extern
EXEC SQL INCLUDE sqlext.h;

extern int status ;
extern FILE *fi;
extern char pipe_msg[254];


int bring_in_err_2()
/* ************************************************************************
   Bring back in all the invent items being resubmitted after corrections
   have been made. Resubmit is at section level.
   ************************************************************************ */
 {

  switch (rmms_flag)
  {
  case 1 :
  case 3 :
  case 4 :
  EXEC SQL INSERT INTO  HHINV_LOAD_2
                ( REC_SEQ_NO,SECT_HDR_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,
                  SCL_CLASS,INV_CODE,PEO_INVENT_BY_ID,INVENT_DATE,
                  X_SECT,ST_CHAIN,END_CHAIN,ROAD_CHARACTERISTIC,
                  survey_length,hhinv_survey_direction, sub_section_length,
                  full_partial_ind,
                  HHFLD1, HHATTR1,HHFLD2,HHATTR2,HHFLD3,HHATTR3,HHFLD4,HHATTR4,
                  HHFLD5,HHATTR5,HHFLD6,HHATTR6,HHFLD7,HHATTR7,
                  HHFLD8,HHATTR8,HHFLD9,HHATTR9,HHFLD10,HHATTR10,
                  HHFLD11,HHATTR11,HHFLD12,HHATTR12,HHFLD13,HHATTR13,
                  HHFLD14,HHATTR14,HHFLD15,HHATTR15,
                  HHFLD16,HHATTR16,HHFLD17,HHATTR17,HHFLD18,HHATTR18,
                  HHFLD19,HHATTR19,HHFLD20,HHATTR20,HHFLD21,HHATTR21,
                  HHFLD22,HHATTR22,HHFLD23,HHATTR23,HHFLD24,HHATTR24,
                  HHFLD25,HHATTR25,HHFLD26,HHATTR26,HHFLD27,HHATTR27,
                  HHFLD28,HHATTR28,HHFLD29,HHATTR29,HHFLD30,HHATTR30,
                  HHFLD31,HHATTR31,HHFLD32,HHATTR32,HHFLD33,HHATTR33,
                  HHFLD34,HHATTR34,HHFLD35,HHATTR35,HHFLD36,HHATTR36,
                  HHFLD37,HHATTR37,HHFLD38,HHATTR38,HHFLD39,HHATTR39,
                  HHFLD40,HHATTR40,HHFLD41,HHATTR41,HHFLD42,HHATTR42,
                  HHFLD43,HHATTR43,HHFLD44,HHATTR44,HHFLD45,HHATTR45,
                  HHFLD46,HHATTR46,HHFLD47,HHATTR47,HHFLD48,HHATTR48,
                  HHFLD49,HHATTR49,HHFLD50,HHATTR50,HHFLD51,HHATTR52,
                  HHFLD53,HHATTR53,HHFLD54,HHATTR54,HHFLD55,HHATTR55,
                  HHFLD56,HHATTR56,HHFLD57,HHATTR57,HHFLD58,HHATTR58,
                  HHFLD59,HHATTR59,HHFLD60,HHATTR60,HHFLD61,HHATTR61,
                  HHFLD62,HHATTR62,HHFLD63,HHATTR63,HHFLD64,HHATTR64,
                  HHFLD65,HHATTR65,HHFLD66,HHATTR66,HHFLD67,HHATTR67,
                  HHFLD68,HHATTR68,HHFLD69,HHATTR69,HHFLD70,HHATTR70,
                  HHFLD71,HHATTR71,HHFLD72,HHATTR72,HHFLD73,HHATTR73,
                  HHFLD74,HHATTR74,HHFLD75,HHATTR75, HHINV_ITY_SYS_FLAG)
           SELECT REC_SEQ_NO,SECT_HDR_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,
                  SCL_CLASS,INV_CODE,PEO_INVENT_BY_ID,INVENT_DATE,
                  X_SECT,ST_CHAIN,END_CHAIN,ROAD_CHARACTERISTIC,
                  survey_length,hhinv_survey_direction, sub_section_length,
                  full_partial_ind,
                  HHFLD1,
                  HHATTR1,HHFLD2,HHATTR2,HHFLD3,HHATTR3,HHFLD4,HHATTR4,
                 HHFLD5,HHATTR5,HHFLD6,HHATTR6,HHFLD7,HHATTR7,
                  HHFLD8,HHATTR8,HHFLD9,HHATTR9,HHFLD10,HHATTR10,
                  HHFLD11,HHATTR11,HHFLD12,HHATTR12,HHFLD13,HHATTR13,
                  HHFLD14,HHATTR14,HHFLD15,HHATTR15,
                  HHFLD16,HHATTR16,HHFLD17,HHATTR17,HHFLD18,HHATTR18,
                  HHFLD19,HHATTR19,HHFLD20,HHATTR20,HHFLD21,HHATTR21,
                  HHFLD22,HHATTR22,HHFLD23,HHATTR23,HHFLD24,HHATTR24,
                  HHFLD25,HHATTR25,HHFLD26,HHATTR26,HHFLD27,HHATTR27,
                  HHFLD28,HHATTR28,HHFLD29,HHATTR29,HHFLD30,HHATTR30,
                  HHFLD31,HHATTR31,HHFLD32,HHATTR32,HHFLD33,HHATTR33,
                  HHFLD34,HHATTR34,HHFLD35,HHATTR35,HHFLD36,HHATTR36,
                  HHFLD37,HHATTR37,HHFLD38,HHATTR38,HHFLD39,HHATTR39,
                  HHFLD40,HHATTR40,HHFLD41,HHATTR41,HHFLD42,HHATTR42,
                  HHFLD43,HHATTR43,HHFLD44,HHATTR44,HHFLD45,HHATTR45,
                  HHFLD46,HHATTR46,HHFLD47,HHATTR47,HHFLD48,HHATTR48,
                  HHFLD49,HHATTR49,HHFLD50,HHATTR50,HHFLD51,HHATTR52,
                  HHFLD53,HHATTR53,HHFLD54,HHATTR54,HHFLD55,HHATTR55,
                  HHFLD56,HHATTR56,HHFLD57,HHATTR57,HHFLD58,HHATTR58,
                  HHFLD59,HHATTR59,HHFLD60,HHATTR60,HHFLD61,HHATTR61,
                  HHFLD62,HHATTR62,HHFLD63,HHATTR63,HHFLD64,HHATTR64,
                  HHFLD65,HHATTR65,HHFLD66,HHATTR66,HHFLD67,HHATTR67,
                  HHFLD68,HHATTR68,HHFLD69,HHATTR69,HHFLD70,HHATTR70,
                  HHFLD71,HHATTR71,HHFLD72,HHATTR72,HHFLD73,HHATTR73,
                  HHFLD74,HHATTR74,HHFLD75,HHATTR75, HHINV_ITY_SYS_FLAG
           FROM   HHINV_ITEM_ERR_2  HHI2
           WHERE  HHI2.SECT_HDR_SEQ_NO
           IN
         ( SELECT REC_SEQ_NO
           FROM   HHINV_SECT_LOG HHSl
           WHERE  RE_SUB_FLG = 'Y'
           AND    HHSl.HHINV_RSE_SYS_FLAG = HHI2.HHINV_ITY_SYS_FLAG
           AND    LST_RUN_NUM = :run_num );
           break;

   default:
   EXEC SQL INSERT INTO  HHINV_LOAD_2
                ( REC_SEQ_NO,SECT_HDR_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,
                  SCL_CLASS,INV_CODE,PEO_INVENT_BY_ID,INVENT_DATE,
                  X_SECT,ST_CHAIN,END_CHAIN,ROAD_CHARACTERISTIC,
                  survey_length,hhinv_survey_direction, sub_section_length,
                  full_partial_ind,
                  HHFLD1, HHATTR1,HHFLD2,HHATTR2,HHFLD3,HHATTR3,HHFLD4,HHATTR4,
                  HHFLD5,HHATTR5,HHFLD6,HHATTR6,HHFLD7,HHATTR7,
                  HHFLD8,HHATTR8,HHFLD9,HHATTR9,HHFLD10,HHATTR10,
                  HHFLD11,HHATTR11,HHFLD12,HHATTR12,HHFLD13,HHATTR13,
                  HHFLD14,HHATTR14,HHFLD15,HHATTR15 ,
                  HHFLD16,HHATTR16,HHFLD17,HHATTR17,HHFLD18,HHATTR18,
                  HHFLD19,HHATTR19,HHFLD20,HHATTR20,HHFLD21,HHATTR21,
                  HHFLD22,HHATTR22,HHFLD23,HHATTR23,HHFLD24,HHATTR24,
                  HHFLD25,HHATTR25,HHFLD26,HHATTR26,HHFLD27,HHATTR27,
                  HHFLD28,HHATTR28,HHFLD29,HHATTR29,HHFLD30,HHATTR30,
                  HHFLD31,HHATTR31,HHFLD32,HHATTR32,HHFLD33,HHATTR33,
                  HHFLD34,HHATTR34,HHFLD35,HHATTR35,HHFLD36,HHATTR36,
                  HHFLD37,HHATTR37,HHFLD38,HHATTR38,HHFLD39,HHATTR39,
                  HHFLD40,HHATTR40,HHFLD41,HHATTR41,HHFLD42,HHATTR42,
                  HHFLD43,HHATTR43,HHFLD44,HHATTR44,HHFLD45,HHATTR45,
                  HHFLD46,HHATTR46,HHFLD47,HHATTR47,HHFLD48,HHATTR48,
                  HHFLD49,HHATTR49,HHFLD50,HHATTR50,HHFLD51,HHATTR52,
                  HHFLD53,HHATTR53,HHFLD54,HHATTR54,HHFLD55,HHATTR55,
                  HHFLD56,HHATTR56,HHFLD57,HHATTR57,HHFLD58,HHATTR58,
                  HHFLD59,HHATTR59,HHFLD60,HHATTR60,HHFLD61,HHATTR61,
                  HHFLD62,HHATTR62,HHFLD63,HHATTR63,HHFLD64,HHATTR64,
                  HHFLD65,HHATTR65,HHFLD66,HHATTR66,HHFLD67,HHATTR67,
                  HHFLD68,HHATTR68,HHFLD69,HHATTR69,HHFLD70,HHATTR70,
                  HHFLD71,HHATTR71,HHFLD72,HHATTR72,HHFLD73,HHATTR73,
                  HHFLD74,HHATTR74,HHFLD75,HHATTR75)
           SELECT REC_SEQ_NO,SECT_HDR_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,
                  SCL_CLASS,INV_CODE,PEO_INVENT_BY_ID,INVENT_DATE,
                  X_SECT,ST_CHAIN,END_CHAIN,ROAD_CHARACTERISTIC,
                  survey_length,hhinv_survey_direction, sub_section_length,
                  full_partial_ind,
                  HHFLD1, HHATTR1,HHFLD2,HHATTR2,HHFLD3,HHATTR3,HHFLD4,HHATTR4,
                  HHFLD5,HHATTR5,HHFLD6,HHATTR6,HHFLD7,HHATTR7,
                  HHFLD8,HHATTR8,HHFLD9,HHATTR9,HHFLD10,HHATTR10,
                  HHFLD11,HHATTR11,HHFLD12,HHATTR12,HHFLD13,HHATTR13,
                  HHFLD14,HHATTR14,HHFLD15,HHATTR15,
                  HHFLD16,HHATTR16,HHFLD17,HHATTR17,HHFLD18,HHATTR18,
                  HHFLD19,HHATTR19,HHFLD20,HHATTR20,HHFLD21,HHATTR21,
                  HHFLD22,HHATTR22,HHFLD23,HHATTR23,HHFLD24,HHATTR24,
                  HHFLD25,HHATTR25,HHFLD26,HHATTR26,HHFLD27,HHATTR27,
                  HHFLD28,HHATTR28,HHFLD29,HHATTR29,HHFLD30,HHATTR30,
                  HHFLD31,HHATTR31,HHFLD32,HHATTR32,HHFLD33,HHATTR33,
                  HHFLD34,HHATTR34,HHFLD35,HHATTR35,HHFLD36,HHATTR36,
                  HHFLD37,HHATTR37,HHFLD38,HHATTR38,HHFLD39,HHATTR39,
                  HHFLD40,HHATTR40,HHFLD41,HHATTR41,HHFLD42,HHATTR42,
                  HHFLD43,HHATTR43,HHFLD44,HHATTR44,HHFLD45,HHATTR45,
                  HHFLD46,HHATTR46,HHFLD47,HHATTR47,HHFLD48,HHATTR48,
                  HHFLD49,HHATTR49,HHFLD50,HHATTR50,HHFLD51,HHATTR52,
                  HHFLD53,HHATTR53,HHFLD54,HHATTR54,HHFLD55,HHATTR55,
                  HHFLD56,HHATTR56,HHFLD57,HHATTR57,HHFLD58,HHATTR58,
                  HHFLD59,HHATTR59,HHFLD60,HHATTR60,HHFLD61,HHATTR61,
                  HHFLD62,HHATTR62,HHFLD63,HHATTR63,HHFLD64,HHATTR64,
                  HHFLD65,HHATTR65,HHFLD66,HHATTR66,HHFLD67,HHATTR67,
                  HHFLD68,HHATTR68,HHFLD69,HHATTR69,HHFLD70,HHATTR70,
                  HHFLD71,HHATTR71,HHFLD72,HHATTR72,HHFLD73,HHATTR73,
                  HHFLD74,HHATTR74,HHFLD75,HHATTR75
           FROM   HHINV_ITEM_ERR_2  HHI2
           WHERE  HHI2.SECT_HDR_SEQ_NO
           IN
         ( SELECT REC_SEQ_NO
           FROM   HHINV_SECT_LOG HHSl
           WHERE  RE_SUB_FLG = 'Y'
           AND    LST_RUN_NUM = :run_num );
   }

  if (sqlca.sqlcode < 0)
    sql_err("bring_in_err_2");
  else
      return(SUCCESS);
 }


int del_old_err_2()
/* *************************************************************************
   Deletes from the error table all those  invent items copied
   out in previous (insert) step as section has been resubmitted.
   ************************************************************************* */
 {

  EXEC SQL DELETE FROM HHINV_ITEM_ERR_2 HHI1
           WHERE  HHI1.SECT_HDR_SEQ_NO
           IN
         ( SELECT REC_SEQ_NO
           FROM   HHINV_SECT_LOG HHSl
           WHERE  RE_SUB_FLG = 'Y'
           AND    LST_RUN_NUM = :run_num );

  if (sqlca.sqlcode < 0)
    sql_err("del_old_err_2");
  else
      return(SUCCESS);
 }
int set_surv_direction()
 {

  EXEC SQL WHENEVER SQLERROR GOTO set_surv_dir;
  EXEC SQL WHENEVER SQLWARNING GOTO set_surv_dir;

  EXEC SQL UPDATE HHINV_SECT_LOG HHSl
           SET    direct_run = 'Y',
                  direct_now = 'Y'
           where  hhsl.sect_start_node =
                (select rse.rse_pus_node_id_end
                 from   road_sections rse
                 where  rse.rse_he_id = hhsl.he_id)
           and   hhsl.lst_run_num = :run_num;

  EXEC SQL UPDATE HHINV_SECT_LOG HHSl
           SET    direct_run = 'N'
           where  hhsl.sect_start_node =
                (select rse.rse_pus_node_id_st
                 from   road_sections rse
                 where  rse.rse_he_id = hhsl.he_id)
           and   hhsl.lst_run_num = :run_num;

  return(SUCCESS);

 set_surv_dir:
  sql_err("set_surv_direction");
  return(FATAL);

 }

int check_surv_direction()
 {

  EXEC SQL WHENEVER SQLERROR GOTO surv_dir;
  EXEC SQL WHENEVER SQLWARNING GOTO surv_dir;

  EXEC SQL UPDATE HHINV_SECT_LOG HHSl
           SET    SUCCESS_STAT = 2,
                  ERROR_LEVEL  = 'SECT',
                 ERROR_MSG    = 'No Survey Direction Supplied'
          WHERE  (HHSl.direct_run not in ('Y','N')  OR
                  HHSl.direct_run is null) AND
                ((HHSl.sect_start_node is null) OR
                 not exists
                 (select 'x'
                  from road_sections rse
                  where rse.rse_pus_node_id_st = hhsl.sect_start_node OR
                        rse.rse_pus_node_id_end = hhsl.sect_start_node))
          and   hhsl.lst_run_num = :run_num;
  return(SUCCESS);
 surv_dir:
 sql_err("check_surv_direction");
 return(FATAL);
 }

upd_l2_xsp()
{
   EXEC SQL WHENEVER sqlerror goto upd_l2_xsp_err;
   EXEC SQL WHENEVER sqlwarning goto upd_l2_xsp_err;

  EXEC SQL UPDATE HHINV_LOAD_2 HHL2
           SET    hhl2.hhinv_survey_direction =
                (select hl1.direct_run
                 from   hhinv_sect_log hl1
                 where  hl1.he_id = hhl2.he_id
                 and    hl1.lst_run_num = :run_num
                 and    hhl2.sect_hdr_seq_no in
                    ( SELECT HHSl.REC_SEQ_NO
                      FROM   HHINV_SECT_LOG HHSl
                      where  hhsl.he_id = hhl2.he_id
                      and    HHSl.LST_RUN_NUM = :run_num ))
          where nvl(hhl2.hhinv_survey_direction,'X') not in ('Y','N');
  return(SUCCESS);

  upd_l2_xsp_err:
   sql_err("upd_l2_xsp");
   return(FATAL);
}


/* Following looks wierd. Done cos later, xsps are reveresed. Therefore,
   set to left lane for reverse direction and it'l get swapped to right
   lane in reversal
*/
set_dflt_xsp()
{
   EXEC SQL WHENEVER sqlerror goto set_dflt_xsp_err;
   EXEC SQL WHENEVER sqlwarning goto set_dflt_xsp_err;

   EXEC SQL update hhinv_load_2
            set x_sect = decode(hhinv_survey_direction,
                         'N',decode(full_partial_ind,'P','CL1','CR1'),
                         'Y',decode(full_partial_ind,'P','CR1','CL1'))
            where x_sect is null
            and inv_code in ( SELECT uvd_inv_code FROM ukpms_view_definitions
                      WHERE uvd_feature_or_survey='S'
                        AND uvd_xsp_type='F');
/*
If the det_xsp is null then leave it as null IT 24-JAN-2003
   EXEC SQL update hhinv_load_2
            set hhfld1 = decode(hhinv_survey_direction,
                         'N',decode(full_partial_ind,'P','CL1','CR1'),
                         'Y',decode(full_partial_ind,'P','CR1','CL1'))
            where hhfld1 is null
            and inv_code in (SELECT uvd_inv_code FROM ukpms_view_definitions
                     WHERE uvd_feature_or_survey='S'
                     AND uvd_xsp_type='F');
*/
  return(SUCCESS);

set_dflt_xsp_err:
   sql_err("set_dflt_xsp");
   return(FATAL);
}


int ck_ch_vs_leng()
/* *************************************************************************
   Flags the section log if any of the inv items are outside tolerances.
   Contiguous and non-Contiguous items are checked separately.
   If any one item is in error the whole section is stopped.
   ************************************************************************* */
 {
   EXEC SQL WHENEVER sqlerror continue;
   EXEC SQL WHENEVER sqlwarning continue;


  switch (rmms_flag)
  {

  case 3 :  /***Oracle ROMIS database structure***/
  case 4 :  /***Welsh Office standard database structure***/

/* *************************************************************************
   Get the tolerances from the System Options -
   ************************************************************************* */

            EXEC SQL select to_number(hop_value)
                     into :strtoldtp
                     from hig_options
                     where hop_id = 'STRTOLDTP';
      if (sqlca.sqlcode < 0)
        sql_err("ck_ch_vs_leng(1)");

            EXEC SQL select to_number(hop_value)
                     into :strtollocl
                     from hig_options
                     where hop_id = 'STRTOLLOCL';
      if (sqlca.sqlcode < 0)
        sql_err("ck_ch_vs_leng(2)");

            EXEC SQL select to_number(hop_value)
                     into :endtoldtp
                     from hig_options
                     where hop_id = 'ENDTOLDTP';
      if (sqlca.sqlcode < 0)
        sql_err("ck_ch_vs_leng(3)");

            EXEC SQL select to_number(hop_value)
                     into :endtollocl
                     from hig_options
                     where hop_id = 'ENDTOLLOCL';
      if (sqlca.sqlcode < 0)
        sql_err("ck_ch_vs_leng(4)");

/* ************************************************************************
   Check non-Contiguous items are not > end of section tolerance -
   ************************************************************************ */

            EXEC SQL update hhinv_load_2 hhl2b
                        set hhl2b.survey_tolerance =
                              (select nvl(min(greatest(
                                        round((rse.rse_length *
                                        utst.utst_tolerance_percent) / 100),
                                        utst.utst_tolerance_absolute)),0)
                                 from road_sections rse,
                                      ukpms_t1_survey_types utst,
                                      ukpms_view_definitions
                                where hhl2b.he_id = rse.rse_he_id
                                  and ((utst_inv_code = hhl2b.inv_code AND
                                        utst_sys_flag = hhl2b.hhinv_ity_sys_flag AND
                                        hhl2b.road_characteristic != 'I')
                                       OR
                                       (utst_inv_code = 'XX'     AND
                                        hhl2b.road_characteristic = 'I')
                                      )
                                  and uvd_ukpms_code = utst_survey_type
                                  and uvd_xsp_method_in_use = 'U'
                              )
                      where hhl2b.he_id is not null
                        and hhl2b.full_partial_ind = 'F';

/*
  Code below is modified for DOE. Doesn't appear to fit with UKPMS. Needs to be re-written
  Incorporating T1 stuff in for now
*/

            EXEC SQL UPDATE HHINV_SECT_LOG HHSl
                     SET    SUCCESS_STAT = 2,
                            ERROR_LEVEL  = 'SECT',
                            ERROR_MSG = 'Inventory Chainage too long'
                     WHERE  (HHSl.REC_SEQ_NO)
                     IN
                   ( SELECT HHL2B.SECT_HDR_SEQ_NO
                     FROM   ROAD_SEGMENTS RSE, INV_ITEM_TYPES ITY,
                            HHINV_LOAD_2 HHL2B
                     WHERE  RSE.RSE_HE_ID = HHL2B.HE_ID
                     AND    nvl(ITY.ITY_CONTIGUOUS,'N') <> 'Y'
                     AND    ITY.ITY_SYS_FLAG = HHL2B.HHINV_ITY_SYS_FLAG
                     AND    ITY.ITY_INV_CODE = HHL2B.INV_CODE
                     AND   ( (RSE.RSE_SYS_FLAG = 'D'
                            AND  nvl(HHL2B.END_CHAIN,HHL2B.ST_CHAIN)
                                 > greatest(nvl(RSE.RSE_LENGTH,0) *
                                 (100 + :endtoldtp) / 100,
                                 nvl(RSE.RSE_MAX_CHAIN,0)  ))
                            OR
                           (RSE.RSE_SCL_SECT_CLASS <> 'NL'
                            AND  RSE.RSE_SYS_FLAG = 'L'
                            AND  nvl(HHL2B.END_CHAIN,HHL2B.ST_CHAIN)
                                 > nvl(RSE.RSE_LENGTH,0) * ((100 + :endtollocl) / 100) ) )
                     AND   RSE.RSE_LENGTH || RSE.RSE_MAX_CHAIN is not null
                     and   hhl2b.survey_length is null)
                     AND   LST_RUN_NUM = :run_num
                     AND   ERROR_MSG IS NULL;


            EXEC SQL UPDATE HHINV_SECT_LOG HHSl
                     SET    SUCCESS_STAT = 2,
                            ERROR_LEVEL  = 'SECT',
                            ERROR_MSG = 'Survey Chainage Outside Tolerance'
                     WHERE  (HHSl.REC_SEQ_NO)
                     IN
                   ( SELECT HHL2B.SECT_HDR_SEQ_NO
                     FROM   HHINV_LOAD_2 HHL2B, ROAD_SEGMENTS RSE
                     WHERE  RSE.RSE_HE_ID = HHL2B.HE_ID
                     AND    RSE.RSE_SYS_FLAG = 'D'
                     AND    nvl(HHL2B.END_CHAIN,HHL2B.ST_CHAIN)
                            >= greatest(nvl(RSE.RSE_LENGTH,0) * :endtoldtp,
                                        nvl(RSE.RSE_MAX_CHAIN,0)  )
                     AND   RSE.RSE_LENGTH || RSE.RSE_MAX_CHAIN is not null
                     and   hhl2b.full_partial_ind is null
                     UNION
                   ( SELECT HHL2B.SECT_HDR_SEQ_NO
                     FROM   HHINV_LOAD_2 HHL2B, ROAD_SEGMENTS RSE
                     WHERE  RSE.RSE_HE_ID = HHL2B.HE_ID
                     AND   RSE.RSE_SCL_SECT_CLASS <> 'NL'
                     AND   RSE.RSE_SYS_FLAG = 'L'
                     AND   ((nvl(HHL2B.SURVEY_LENGTH, HHL2B.END_CHAIN)
                           > nvl(RSE.RSE_LENGTH,0) + hhl2b.survey_tolerance)
                      OR
                           (nvl(HHL2B.SURVEY_LENGTH, HHL2B.END_CHAIN)
                           < nvl(RSE.RSE_LENGTH,0) - hhl2b.survey_tolerance))
                     AND   RSE.RSE_LENGTH || RSE.RSE_MAX_CHAIN is not null
                     and   hhl2b.survey_length is not null ) )
               AND   LST_RUN_NUM = :run_num
               AND   ERROR_MSG IS NULL;


      if (sqlca.sqlcode < 0)
        sql_err("ck_ch_vs_leng(5)");

/* ************************************************************************
   Check Contiguous items are not > start of section tolerance, and are
   within +/- end of section tolerance; first and last items in a sequence
   are checked respectively -
   ************************************************************************ */
/*
  Code below is modified for DOE. Doesn't appear to fit with UKPMS. Needs to be re-written
  Incorporating T1 stuff in for now


            EXEC SQL UPDATE HHINV_SECT_LOG HHSl
              SET  SUCCESS_STAT = 2,
                   ERROR_LEVEL  = 'SECT',
                   ERROR_MSG = '1st Contig. item starts outside Tolerance'
              WHERE  (HHSl.REC_SEQ_NO)
              IN
            ( SELECT HHL2B.SECT_HDR_SEQ_NO
              FROM   ROAD_SEGMENTS RSE, INV_ITEM_TYPES ITY, HHINV_LOAD_2 HHL2B
              WHERE  RSE.RSE_HE_ID = HHL2B.HE_ID
              AND    ITY.ITY_CONTIGUOUS = 'Y'
              AND    ITY.ITY_SYS_FLAG = HHL2B.HHINV_ITY_SYS_FLAG
              AND    ITY.ITY_INV_CODE = HHL2B.INV_CODE
              AND   (RSE.RSE_SYS_FLAG = 'D'
                     AND HHL2B.ST_CHAIN > :strtoldtp
                     OR  RSE.RSE_SCL_SECT_CLASS <> 'NL'
                     AND RSE.RSE_SYS_FLAG = 'L'
                     AND HHL2B.ST_CHAIN > :strtollocl)
              AND    HHL2B.ST_CHAIN = (SELECT MIN(HHL3B.ST_CHAIN)
                                       FROM HHINV_LOAD_2 HHL3B
                                       WHERE HHL3B.HE_ID = HHL2B.HE_ID
                                       AND   HHL3B.INV_CODE = HHL2B.INV_CODE
                                       AND   NVL(HHL3B.X_SECT,'@') =
                                                NVL(HHL2B.X_SECT,'@')
                                       AND   HHL3B.HHINV_ITY_SYS_FLAG =
                                                HHL2B.HHINV_ITY_SYS_FLAG)
              AND    NOT EXISTS (SELECT 1 FROM INV_ITEMS IIT
                                 WHERE IIT.IIT_RSE_HE_ID = HHL2B.HE_ID
                                 AND   IIT.IIT_ITY_INV_CODE = HHL2B.INV_CODE
                                 AND   NVL(IIT.IIT_X_SECT,'@') =
                                           NVL(HHL2B.X_SECT,'@')
                                 AND   IIT.IIT_ITY_SYS_FLAG =
                                           HHL2B.HHINV_ITY_SYS_FLAG
                                 AND   IIT.IIT_ST_CHAIN < HHL2B.ST_CHAIN)
            )
              AND   LST_RUN_NUM = :run_num
              AND   ERROR_MSG IS NULL;


      if (sqlca.sqlcode < 0)
               sql_err("ck_ch_vs_leng(6)");

            EXEC SQL UPDATE HHINV_SECT_LOG HHSl
              SET  SUCCESS_STAT = 2,
                   ERROR_LEVEL  = 'SECT',
                   ERROR_MSG = 'Last Contig.item ends outside Tolerance'
              WHERE  (HHSl.REC_SEQ_NO)
              IN
            ( SELECT HHL2B.SECT_HDR_SEQ_NO
              FROM   ROAD_SEGMENTS RSE, INV_ITEM_TYPES ITY, HHINV_LOAD_2 HHL2B
              WHERE  RSE.RSE_HE_ID = HHL2B.HE_ID
              AND    ITY.ITY_CONTIGUOUS = 'Y'
              AND    ITY.ITY_SYS_FLAG = HHL2B.HHINV_ITY_SYS_FLAG
              AND    ITY.ITY_INV_CODE = HHL2B.INV_CODE
              AND  (RSE.RSE_SYS_FLAG = 'D'
                    AND (nvl(HHL2B.END_CHAIN,HHL2B.ST_CHAIN)
                         >= greatest(nvl(RSE.RSE_LENGTH,0) * (100 + :endtoldtp)
                                                              / 100,
                                     nvl(RSE.RSE_MAX_CHAIN,0) )
                         OR   nvl(HHL2B.END_CHAIN,HHL2B.ST_CHAIN)
                         <= nvl(RSE.RSE_LENGTH,0) * (100 - :endtoldtp) / 100)
                    OR  RSE.RSE_SCL_SECT_CLASS <> 'NL'
                    AND RSE.RSE_SYS_FLAG = 'L'
                    AND (nvl(HHL2B.END_CHAIN,HHL2B.ST_CHAIN)
                         >= greatest(nvl(RSE.RSE_LENGTH,0) * (100 + :endtollocl)
                                                              / 100,
                                     nvl(RSE.RSE_MAX_CHAIN,0) )
                         OR nvl(HHL2B.END_CHAIN,HHL2B.ST_CHAIN)
                         <= nvl(RSE.RSE_LENGTH,0) * (100 - :endtollocl) / 100)
              AND   RSE.RSE_LENGTH || RSE.RSE_MAX_CHAIN is not null)
              AND   NVL(HHL2B.END_CHAIN,HHL2B.ST_CHAIN) =
                                (SELECT MAX(NVL(HHL3B.END_CHAIN,HHL3B.ST_CHAIN))
                                 FROM HHINV_LOAD_2 HHL3B
                                 WHERE HHL3B.HE_ID = HHL2B.HE_ID
                                 AND   HHL3B.INV_CODE = HHL2B.INV_CODE
                                 AND   NVL(HHL3B.X_SECT,'@') =
                                           NVL(HHL2B.X_SECT,'@')
                                 AND   HHL3B.HHINV_ITY_SYS_FLAG =
                                           HHL2B.HHINV_ITY_SYS_FLAG)
              AND    NOT EXISTS (SELECT 1 FROM INV_ITEMS IIT
                                 WHERE IIT.IIT_RSE_HE_ID = HHL2B.HE_ID
                                 AND   IIT.IIT_ITY_INV_CODE = HHL2B.INV_CODE
                                 AND   NVL(IIT.IIT_X_SECT,'@') =
                                           NVL(HHL2B.X_SECT,'@')
                                 AND   IIT.IIT_ITY_SYS_FLAG =
                                           HHL2B.HHINV_ITY_SYS_FLAG
                                 AND   IIT.IIT_END_CHAIN >
                                           NVL(HHL2B.END_CHAIN,HHL2B.ST_CHAIN))
            )
              AND   LST_RUN_NUM = :run_num
              AND   ERROR_MSG IS NULL;
*/
                     break;

  case 2 :  /***Oracle/Hims hybrid RMMS database structure ***/

            EXEC SQL UPDATE HHINV_SECT_LOG HHSl
                     SET    SUCCESS_STAT = 2,
                            ERROR_LEVEL  = 'SECT',
                            ERROR_MSG = 'Inventory Chainage too long'
                     WHERE  (HHSl.REC_SEQ_NO)
                     IN
                   ( SELECT HHL2B.SECT_HDR_SEQ_NO
                     FROM   HHINV_LOAD_2 HHL2B, ROAD_SECTIONS RSE
                     WHERE  RSE.RSE_HE_ID = HHL2B.HE_ID
                     AND    nvl(HHL2B.END_CHAIN,HHL2B.ST_CHAIN)
                            > greatest(nvl(RSE.RSE_LENGTH,0) * 1.1,
                                        nvl(RSE.RSE_MAX_CHAIN,0)    )
                     AND   RSE.RSE_LENGTH || RSE.RSE_MAX_CHAIN is not null  )
                     AND   LST_RUN_NUM = :run_num
                     AND   ERROR_MSG IS NULL;

                     break;

  case 1 :  /***Oracle DTp standard RMMS database structure***/
  default:

            EXEC SQL UPDATE HHINV_SECT_LOG HHSl
                     SET    SUCCESS_STAT = 2,
                            ERROR_LEVEL  = 'SECT',
                            ERROR_MSG = 'Inventory Chainage too long'
                     WHERE  (HHSl.REC_SEQ_NO)
                     IN
                   ( SELECT HHL2B.SECT_HDR_SEQ_NO
                     FROM   HHINV_LOAD_2 HHL2B, ROAD_SEGMENTS RSE
                     WHERE  RSE.RSE_HE_ID = HHL2B.HE_ID
                     AND    nvl(HHL2B.END_CHAIN,HHL2B.ST_CHAIN)
                            > greatest(nvl(RSE.RSE_LENGTH,0) * 1.1,
                                        nvl(RSE.RSE_MAX_CHAIN,0)    )
                     AND   RSE.RSE_LENGTH || RSE.RSE_MAX_CHAIN is not null  )
                     AND   LST_RUN_NUM = :run_num
                     AND   ERROR_MSG IS NULL;
                     break;


  } /*END BRACE switch*/

  if (sqlca.sqlcode < 0)
    sql_err("ck_ch_vs_leng(7)");
  else
      return(SUCCESS);
 }

set_new_length()
{
/* printf ("set length\n"); */
  EXEC SQL WHENEVER SQLERROR continue;
  EXEC SQL WHENEVER SQLWARNING continue;

            EXEC SQL UPDATE ROAD_SEGMENTS rse
                   set rse.rse_length =
                     (select greatest(min(hhl2b.survey_length),max(hhl2b.end_chain))
                      from   hhinv_load_2 hhl2b
                      where  hhl2b.he_id = rse.rse_he_id
                      and    nvl(rse.rse_length_status,'U') in ('E','U')
                      and    hhl2b.survey_length <= rse.rse_length +
                                            hhl2b.survey_tolerance
                      and    hhl2b.survey_length >= rse.rse_length -
                                            hhl2b.survey_tolerance
                      and    hhl2b.survey_length <= rse.rse_length +
                                            hhl2b.sub_section_length
                      and    hhl2b.survey_length >= rse.rse_length -
                                            hhl2b.sub_section_length),
                      rse.rse_length_status = 'M'
                   where exists
                     (select 'x'
                      from hhinv_load_2 hhl2c
                      where hhl2c.he_id = rse.rse_he_id
                      and    hhl2c.full_partial_ind = 'F'
                      and    nvl(rse.rse_length_status,'U') in ('E','U')
                      and    hhl2c.survey_length <= rse.rse_length +
                                            hhl2c.survey_tolerance
                      and    hhl2c.survey_length >= rse.rse_length -
                                            hhl2c.survey_tolerance
                      and    hhl2c.survey_length <= rse.rse_length +
                                            hhl2c.sub_section_length
                      and    hhl2c.survey_length >= rse.rse_length -
                                            hhl2c.sub_section_length
                      and   nvl(rse.rse_length_status,'U') in ('E','U'));


   return(SUCCESS);

 newlen_err:
  sql_err("set_new_length");
  return(FATAL);
}


int recalibrate_inv_chain()
/**************************************************************************
 Recalibrates the inventory chainages where the maximum chainage of any
 inventory item <> recorded max. chainage for the section.
**************************************************************************/
  {
  EXEC SQL select nvl(min(hop_value),'N')
             into :recal_option
             from hig_options
            where hop_product = 'MAI'
              and hop_id = 'DORECAL'
                ;
  if(sqlca.sqlcode < 0)
    {
    sql_err("recalibrate_inv_chain - get DORECAL System Option");
    }

  recal_option.arr[1] = '\0';
  recal_option.len = 1;

  if((rmms_flag == 3 || rmms_flag == 4) && (recal_option.arr[0] == 'Y'))
    {
    write_pipe(NULL,"INFO: Recalibration is being applied to this load.");

    EXEC SQL create table hhinv_temp_7883 (he_id number(8), max_chain number);
    if(sqlca.sqlcode < 0)
      {
      sql_err("recalibrate_inv_chain(1)");
      }

    EXEC SQL insert
               into hhinv_temp_7883
             select he_id
                   ,greatest(max(nvl(end_chain, st_chain))
                            ,max(nvl(iit_end_chain,0)))
               from road_segments_all
                   ,inv_items
                   ,hhinv_load_2
              where /*hhinv_ity_sys_flag = 'L'      --commented out for nm31
                and*/ nvl(error_flg,'N') != 'Y'
                and he_id = rse_he_id
                and rse_scl_sect_class <> 'NL'
                and he_id = iit_rse_he_id (+)
              group
                 by he_id
                  ;
    if(sqlca.sqlcode < 0)
      {
      sql_err("recalibrate_inv_chain(2)");
      }

    EXEC SQL create unique index hhinv_temp_7883_ind on hhinv_temp_7883 (he_id);
    if(sqlca.sqlcode < 0)
      {
      sql_err("recalibrate_inv_chain(3)");
      }

    /* (NOTE: This SQL uses decodes extensively to allow for zero values) */
    EXEC SQL UPDATE hhinv_load_2 hl2
                SET (hl2.st_chain, hl2.end_chain)
                   =(SELECT hl2.st_chain*decode(b.rse_length/decode(a.max_chain,0,decode(b.rse_length,0,1,b.rse_length),a.max_chain)
                                               ,0,1
                                               ,1,1
                                               ,b.rse_length / a.max_chain)
                           ,hl2.end_chain*decode(b.rse_length/decode(a.max_chain,0,decode(b.rse_length,0,1,b.rse_length),a.max_chain)
                                                ,0,1
                                                ,1,1
                                                ,b.rse_length/a.max_chain)
                       FROM road_segments_all b
                           ,hhinv_temp_7883 a
                      WHERE hl2.he_id = a.he_id
                        AND b.rse_he_id = a.he_id)
              WHERE 'NL'<>(select rse_scl_sect_class
                             from road_segments_all
                            where rse_he_id = hl2.he_id)
                AND nvl(hl2.error_flg,'N') != 'Y'
--                AND hl2.hhinv_ity_sys_flag  = 'L'  -- commented out for nm3.1.1.0
                AND hl2.full_partial_ind    = 'F'
                AND (hl2.inv_code in(select utst_inv_code
                                       from ukpms_t1_survey_types
                                           ,ukpms_view_definitions
                                      where utst_fit_method in ('R','F')
                                        and utst_sys_flag  = hl2.hhinv_ity_sys_flag
                                        and uvd_ukpms_code = utst_survey_type
                                        and uvd_xsp_method_in_use = 'U')
                    OR
                    hl2.road_characteristic = 'I')
                  ;
    if(sqlca.sqlcode < 0)
      {
      sql_err("recalibrate_inv_chain(4)");
      }

    EXEC SQL drop table hhinv_temp_7883;
    if(sqlca.sqlcode < 0)
      {
      sql_err("recalibrate_inv_chain(5)");
      }

    } /*END IF */

/*
  else
     write_pipe(NULL,"INFO: Recalibration is NOT being applied to this load.");
*/

  return((sqlca.sqlcode>=0)?SUCCESS:FATAL);
  }

int validate_mc_data_direction()
/* *************************************************************************
   Checks that the road section for which the machine data is being loaded
   has a network direction recorded against it and that the machine data
   direction is compatible ie. if network direction is 'NB' (North Bound)
   the machine data direction mutst be either 'NB' or 'SB' and cannot be 'WB'
   or 'EB'.
   ************************************************************************* */
 {

  EXEC SQL SELECT hop_VALUE
           INTO   :standard_xsp
           FROM   hig_OPTIONS
           WHERE  hop_id = 'XSPSTDDIR';
  if (sqlca.sqlcode < 0)
    sql_err("validate_mc_data_direction(1)");

  EXEC SQL SELECT hop_VALUE
           INTO   :reverse_xsp
           FROM   hig_OPTIONS
           WHERE  hop_id = 'XSPREVDIR';
  if (sqlca.sqlcode < 0)
    sql_err("validate_mc_data_direction(2)");

/* ARTEST START */
/* Commented this section out for initial testing. */
/* Barnet database changed so that network direction was properly set. */
/* So now re-introducing this check */

  EXEC SQL UPDATE HHINV_SECT_LOG HHSl
           SET    SUCCESS_STAT = 2,
                  ERROR_LEVEL  = 'SECT',
                  ERROR_MSG    = 'No Network Direction on Section'
           WHERE  HHSl.HE_ID IN (SELECT RSE_HE_ID
                                 FROM   ROAD_SEGMENTS_ALL RSE,
                                        HHINV_LOAD_2 HL2,
                                        INV_ITEM_TYPES ITY,
                                        V_UKPMS_ROAD_SECTION
                                 WHERE  RSE.RSE_HE_ID = HL2.HE_ID
                                 AND    RSE.RSE_HE_ID = IIT_RSE_HE_ID
                                 AND    HL2.INV_CODE = ITY.ITY_INV_CODE
                                 AND    ITY.ITY_ROAD_CHARACTERISTIC = 'M'
                                 AND    (RSE.RSE_NETWORK_DIRECTION IS NULL
                                         AND SURV_DIRECTION IS NULL) );
  if (sqlca.sqlcode < 0)
    sql_err("validate_mc_data_direction(3)");

/* ARTEST END */

/*
  EXEC SQL UPDATE HHINV_LOAD_2 HL2
           SET    ERROR_MSG = 'Conflicting or Incorrect Directions',
                  ERROR_FLG = 'Y'
           WHERE  HL2.HE_ID IN (SELECT RSE.RSE_HE_ID
                                FROM   ROAD_SEGMENTS_ALL RSE
                                WHERE ((RSE.RSE_NETWORK_DIRECTION IN ('NB','SB')
                                AND     HL2.HHFLD2 NOT IN ('NB','SB'))
                                OR     (RSE.RSE_NETWORK_DIRECTION IN ('EB','WB')
                                AND     HL2.HHFLD2 NOT IN ('EB','WB'))))
           AND    HL2.INV_CODE IN (SELECT ITY.ITY_INV_CODE
                                   FROM   INV_ITEM_TYPES ITY
                                   WHERE  ITY.ITY_ROAD_CHARACTERISTIC = 'M');
*/
  if (sqlca.sqlcode < 0)
    sql_err("validate_mc_data_direction(4)");
  else
      return(SUCCESS);
 }

int reverse_machine_data_chs()
/* *************************************************************************
   Reverses the chainages and set the XSPs of all machine data (except skid
   results) taken in the opposite direction to the network direction
   recorded against the road section for which it is being loaded.
   ************************************************************************* */
 {

/* Reverse chainages and set reverse XSPs */
  EXEC SQL UPDATE HHINV_LOAD_2 HL2
           SET (ST_CHAIN,END_CHAIN)
                = (SELECT DECODE(HL2.END_CHAIN, NULL,
                                 RSE.RSE_LENGTH - HL2.ST_CHAIN,
                                 RSE.RSE_LENGTH - HL2.END_CHAIN),
                          DECODE(HL2.END_CHAIN, NULL, NULL,
                                 RSE.RSE_LENGTH - HL2.ST_CHAIN)
                   FROM   ROAD_SEGMENTS RSE
                   WHERE  RSE.RSE_HE_ID = HL2.HE_ID),
                X_SECT =
                  (SELECT nvl(min(XRV_NEW_XSP),HL2.X_SECT)
                   from   xsp_reversal
                   where  xrv_old_xsp = HL2.X_SECT)

           WHERE HL2.HE_ID IN
                   (SELECT RSE2.RSE_HE_ID
                    FROM   ROAD_SEGMENTS_ALL RSE2
                    WHERE (RSE2.RSE_NETWORK_DIRECTION = 'NB'
                    AND    HL2.hhinv_survey_direction = 'Y')
                    OR    (RSE2.RSE_NETWORK_DIRECTION = 'SB'
                    AND    HL2.hhinv_survey_direction = 'Y')
                    OR    (RSE2.RSE_NETWORK_DIRECTION = 'EB'
                    AND    HL2.hhinv_survey_direction = 'Y')
                    OR    (RSE2.RSE_NETWORK_DIRECTION = 'WB'
                    AND    HL2.hhinv_survey_direction = 'Y'))
           AND   HE_ID is not null
           and   hl2.full_partial_ind = 'F'
           AND   ROAD_CHARACTERISTIC = 'M'
           -- AND   INV_CODE != 'SR'
           AND   NVL(HL2.ERROR_FLG,'N') != 'Y';
        if (sqlca.sqlcode < 0)
                sql_err("reverse_machine_data_chs(1)");

   EXEC SQL UPDATE HHINV_LOAD_2 HL2
           SET (ST_CHAIN,END_CHAIN)
                = (SELECT DECODE(HL2.END_CHAIN, NULL,
                                 RSE.RSE_LENGTH - HL2.ST_CHAIN,
                                 RSE.RSE_LENGTH - HL2.END_CHAIN),
                          DECODE(HL2.END_CHAIN, NULL, NULL,
                                 RSE.RSE_LENGTH - HL2.ST_CHAIN)
                   FROM   ROAD_SEGMENTS RSE
                   WHERE  RSE.RSE_HE_ID = HL2.HE_ID),
                HHFLD1 =
                  (SELECT nvl(min(UXR_REVERSED_XSP),HL2.HHFLD1)
                   from   ukpms_xsp_reversal
                   where  uxr_normal_xsp = HL2.HHFLD1)
           WHERE HL2.HE_ID IN
                   (SELECT RSE2.RSE_HE_ID
                    FROM   ROAD_SEGMENTS_ALL RSE2
                    WHERE (nvl(RSE2.RSE_NETWORK_DIRECTION,'NB') = 'NB'
                    AND    HL2.hhinv_survey_direction = 'Y')
                    OR    (nvl(RSE2.RSE_NETWORK_DIRECTION,'SB') = 'SB'
                    AND    HL2.hhinv_survey_direction = 'Y')
                    OR    (nvl(RSE2.RSE_NETWORK_DIRECTION,'EB') = 'EB'
                    AND    HL2.hhinv_survey_direction = 'Y')
                    OR    (nvl(RSE2.RSE_NETWORK_DIRECTION,'WB') = 'WB'
                    AND    HL2.hhinv_survey_direction = 'Y'))
           AND   HE_ID is not null
           and   hl2.full_partial_ind = 'F'
           AND   ROAD_CHARACTERISTIC = 'M'
           -- AND   INV_CODE != 'SR'
           AND   NVL(HL2.ERROR_FLG,'N') != 'Y';
        if (sqlca.sqlcode < 0)
                sql_err("reverse_machine_data_chs(3)");

/*
  EXEC SQL UPDATE HHINV_LOAD_2 HL2
           SET    X_SECT = :standard_xsp
           WHERE  ROAD_CHARACTERISTIC = 'M'
           AND    INV_CODE != 'SR'
           AND    NVL(X_SECT,'@') != :reverse_xsp;

  if (sqlca.sqlcode < 0)
    sql_err("reverse_machine_data_chs(2)");
  else
      return(SUCCESS);
*/
      return(SUCCESS);
 }

int reverse_skid_results()
/* *************************************************************************
   Reverses the readings and sets the XSPs of skid results taken in the
   opposite direction to the network direction recorded against the road
   section for which it is being loaded.
   ************************************************************************* */
 {

  EXEC SQL EXECUTE
    DECLARE
      l_rse_he_id    ROAD_SEGMENTS_ALL.RSE_HE_ID%TYPE;
      l_rse_net_dirn ROAD_SEGMENTS_ALL.RSE_NETWORK_DIRECTION%TYPE;
      l_dummy        NUMBER;
      l_index        INTEGER;

    CURSOR c1 IS
      SELECT DISTINCT RSE.RSE_HE_ID
            ,RSE.RSE_NETWORK_DIRECTION
      FROM   ROAD_SEGMENTS_ALL RSE
            ,HHINV_LOAD_2 HHL
      WHERE  HHL.HE_ID = RSE.RSE_HE_ID
      AND    HHL.INV_CODE = 'SR';

    CURSOR c2 IS
      SELECT 1
      FROM   HHINV_LOAD_2
      WHERE  HE_ID = l_rse_he_id
      AND    hhinv_survey_direction != l_rse_net_dirn
      AND    INV_CODE = 'SR'
      AND    NVL(ERROR_FLG,'N') != 'Y'
      ORDER BY ST_CHAIN
      FOR UPDATE OF HHFLD3
                   ,HHFLD4
                   ,HHFLD5
                   ,HHFLD6
                   ,HHFLD7
                   ,X_SECT;

    TYPE readings IS TABLE OF NUMBER INDEX BY BINARY_INTEGER;
    reading1 readings;
    reading2 readings;
    reading3 readings;
    reading4 readings;
    reading5 readings;

  BEGIN

   /* set XSPs of data taken in the network direction */
    UPDATE HHINV_LOAD_2
    SET    X_SECT = :standard_xsp
    WHERE  hhinv_survey_direction  = (SELECT RSE_NETWORK_DIRECTION
                     FROM   ROAD_SEGMENTS_ALL
                     WHERE  RSE_HE_ID = HE_ID)
    AND    NVL(ERROR_FLG,'N') != 'Y'
    AND    INV_CODE = 'SR';

    open  c1;
    loop
      fetch c1 into l_rse_he_id    /* fetch section and network direction */
                   ,l_rse_net_dirn;
      exit when c1%notfound;

      l_index := 0;

      for data_rec in (SELECT HHFLD3         /* retrieve all readings for */
                             ,HHFLD4         /* section not taken in the  */
                             ,HHFLD5         /* network direction in      */
                             ,HHFLD6         /* descending order of start */
                             ,HHFLD7         /* chainage                  */
                       FROM   HHINV_LOAD_2
                       WHERE  HE_ID = l_rse_he_id
                       AND    hhinv_survey_direction != l_rse_net_dirn
                       AND    INV_CODE = 'SR'
                       AND    NVL(ERROR_FLG,'N') != 'Y'
                       ORDER  BY ST_CHAIN DESC)
      loop

     /* store all skid data readings */
        l_index := l_index + 1;
        reading1(l_index) := data_rec.hhfld3;
        reading2(l_index) := data_rec.hhfld4;
        reading3(l_index) := data_rec.hhfld5;
        reading4(l_index) := data_rec.hhfld6;
        reading5(l_index) := data_rec.hhfld7;

      end loop;

      l_index := 0;
      open c2;
      loop
        fetch c2 into l_dummy;   /* fetch skid records to update in order of */
        exit when c2%notfound;   /* start chainage                           */

        l_index := l_index + 1;

     /* save readings to database in reverse order */
        UPDATE HHINV_LOAD_2
        SET HHFLD3 = reading1(l_index)
           ,HHFLD4 = reading2(l_index)
           ,HHFLD5 = reading3(l_index)
           ,HHFLD6 = reading4(l_index)
           ,HHFLD7 = reading5(l_index)
           ,X_SECT = :reverse_xsp
        WHERE CURRENT OF c2;

      end loop;

      close c2;
      commit;

    end loop;

    close c1;

 /* set XSPs for data taken in network direction */
/*
    UPDATE HHINV_LOAD_2 HL2
    SET    X_SECT = :standard_xsp
    WHERE  ROAD_CHARACTERISTIC = 'M'
    AND    NVL(X_SECT,'@') != :reverse_xsp;
*/

  end;

  END-EXEC;

  return((sqlca.sqlcode>=0)?SUCCESS:FATAL);
 }

int check_contiguous_overlap()
/* *************************************************************************
   Rejects any contiguous inventory which overlaps with either existing
   inventory or other inventory in the file being loaded
   ************************************************************************* */

 {

  EXEC SQL UPDATE HHINV_LOAD_2 HHL2
           SET    HHL2.ERROR_MSG = 'Overlapping Contiguous Inventory'
                 ,HHL2.ERROR_FLG = 'Y'
           WHERE (
                  HHL2.REC_SEQ_NO IN (
                  SELECT H2.REC_SEQ_NO
                  FROM   HHINV_LOAD_2 H1
                        ,HHINV_LOAD_2 H2
                  WHERE ( H1.rec_seq_no > H2.rec_seq_no
                      or  H1.rec_seq_no < H2.rec_seq_no )
                  AND    H1.HE_ID      = H2.HE_ID
                  AND    H1.INV_CODE   = H2.INV_CODE
                  AND  ( H1.X_SECT =   H2.X_SECT
                   or    H1.X_SECT is null and H2.X_SECT is null )
                  AND    H1.ST_CHAIN  < H2.END_CHAIN
                  AND    H1.END_CHAIN > H2.ST_CHAIN )
           OR     EXISTS (
                  SELECT 1
                  FROM   INV_ITEMS IIT
                  WHERE  IIT.IIT_RSE_HE_ID    = HHL2.HE_ID
                  AND    HHL2.ROAD_CHARACTERISTIC in ('I','R','T')
                  AND    IIT.IIT_ITY_INV_CODE = HHL2.INV_CODE
                  AND   (IIT.IIT_X_SECT = HHL2.X_SECT
                         or iit.iit_x_sect is null and hhl2.x_sect is null)
                  AND    IIT.IIT_ST_CHAIN  < HHL2.END_CHAIN
                  AND    IIT.IIT_END_CHAIN > HHL2.ST_CHAIN
                        )
                 )
           AND    HHL2.INV_CODE IN
                 (SELECT ITY.ITY_INV_CODE
                  FROM   INV_ITEM_TYPES ITY
                  WHERE  HHL2.HHINV_ITY_SYS_FLAG = ITY.ITY_SYS_FLAG
                  AND    ITY.ITY_CONTIGUOUS      = 'Y');

  if (sqlca.sqlcode < 0)
    sql_err("check_contiguous_overlap");
  else
      return(SUCCESS);
 }

int check_contiguous_gap()
/* **************************************************************
   Reject any contiguous inventory which has non-permissible gaps
   between adjacent items, checking against items being loaded or
   already on INV_ITEMS
   ************************************************************** */

 {

  EXEC SQL update hhinv_sect_log rsl
           set success_stat = 2,
               error_level = 'SECT',
               error_msg = 'Gaps detected between Contiguous Items'
           where rec_seq_no in
             (select hhl2.sect_hdr_seq_no
              from inv_item_types it, hhinv_load_2 hhl2
              where it.ity_contiguous = 'Y'
              and   hhl2.hhinv_ity_sys_flag = it.ity_sys_flag
              and   hhl2.inv_code = it.ity_inv_code
              and   not exists
                (select 1 from hhinv_load_2 h1
                 where h1.he_id = hhl2.he_id
                 and   h1.inv_code = hhl2.inv_code
                 and   nvl(h1.x_sect,'@') = nvl(hhl2.x_sect,'@')
                 and   h1.hhinv_ity_sys_flag = hhl2.hhinv_ity_sys_flag
                 and   h1.st_chain <= nvl(hhl2.end_chain,-2)
                                     + it.ity_contig_joins_gap
                 and   nvl(h1.end_chain,h1.st_chain) >
                                     nvl(hhl2.end_chain,hhl2.st_chain)
                )
              and   not exists
                (select 1 from inv_items i1
                 where i1.iit_rse_he_id = hhl2.he_id
                 and   i1.iit_ity_inv_code = hhl2.inv_code
                 and   nvl(i1.iit_x_sect,'@') = nvl(hhl2.x_sect,'@')
                 and   i1.iit_ity_sys_flag = hhl2.hhinv_ity_sys_flag
                 and   i1.iit_st_chain <= nvl(hhl2.end_chain,-2)
                                         + it.ity_contig_joins_gap
                 and   i1.iit_end_chain > nvl(hhl2.end_chain,hhl2.st_chain)
                )
              and   (exists
                       (select 1 from hhinv_load_2 h2
                        where nvl(h2.end_chain,h2.st_chain) >
                                    nvl(hhl2.end_chain,hhl2.st_chain)
                        and   h2.he_id = hhl2.he_id
                        and   h2.inv_code = hhl2.inv_code
                        and   nvl(h2.x_sect,'@') = nvl(hhl2.x_sect,'@')
                        and   h2.hhinv_ity_sys_flag = hhl2.hhinv_ity_sys_flag
                       )
                     or exists
                       (select 1 from inv_items i2
                        where i2.iit_end_chain > nvl(hhl2.end_chain,hhl2.st_chain)
                        and   i2.iit_rse_he_id = hhl2.he_id
                        and   i2.iit_ity_inv_code = hhl2.inv_code
                        and   nvl(i2.iit_x_sect,'@') = nvl(hhl2.x_sect,'@')
                        and   i2.iit_ity_sys_flag = hhl2.hhinv_ity_sys_flag
                       )
                     )
             )
           and   lst_run_num = :run_num
           and   error_msg is null;

  if (sqlca.sqlcode < 0)
    sql_err("check_contiguous_gap");
  else
      return(SUCCESS);
 }

int upd_inv_for_sect_2()
/* *************************************************************************
   Mark all invent items in sector which are flagged as in  error to
   exclude them from further processing and ensure are pulled out to
   await corrections to the source of the error.
   ************************************************************************* */
 {

  EXEC SQL UPDATE HHINV_LOAD_2 HHL2
           SET    ERROR_FLG = 'Y'
           WHERE  HHL2.SECT_HDR_SEQ_NO
           IN
         ( SELECT HHSl.REC_SEQ_NO
           FROM   HHINV_SECT_LOG HHSl
           WHERE  HHSl.ERROR_LEVEL = 'SECT'
           AND    HHSl.LST_RUN_NUM = :run_num );

  if (sqlca.sqlcode < 0)
    sql_err("upd_inv_for_sect_2");
  else
      return(SUCCESS);
 }

int upd_x_length()
/* *************************************************************************
   Updates Sections with a length if they do not have one
        - Function depends on the fact that ERROR_FLG on hhinv_load_2 is
          only set to 'Y' due to Section Errors and so all items in
          section will be stopped.
   ************************************************************************* */
 {

  switch (rmms_flag)
  {

  case 3 :  /***Oracle ROMIS database structure***/
  case 4 :  /***Welsh Office standard database structure***/

/*  Following performance problems with the code below it has been
    re-coded to use a temporary table. Problem reported by Gloucester CC
    SEP-91 and fixed by R. Strong - bug no 134590.

  EXEC SQL update road_segments rse
           set (rse.rse_length,rse.rse_max_chain)
               = (select decode(nvl(rse.rse_length,0),0,
                                max(nvl(hhl2a.end_chain,hhl2a.st_chain)),
                                rse.rse_length),
                         greatest(nvl(rse.rse_max_chain,0),
                                     max(nvl(hhl2a.end_chain,hhl2a.st_chain)))
                  from   hhinv_load_2 hhl2a
                  where  hhl2a.he_id = rse.rse_he_id
                  and    nvl(hhl2a.error_flg,'N') != 'Y')
           where   rse.rse_type = 'S'
           and   rse.rse_end_date is null
           and   exists
                       (select 'A'
                        from hhinv_load_2 hhl2b
                        where hhl2b.he_id = rse.rse_he_id
                        and   nvl(hhl2b.error_flg,'N') != 'Y');
                        ---------------------------------------     */
  EXEC SQL create table hhinv_temp_7883
           (he_id number(8), max_chain number);
        if (sqlca.sqlcode < 0)
                sql_err("upd_x_length(1)");


  EXEC SQL insert into hhinv_temp_7883
           select he_id, max(nvl(end_chain, st_chain))
           from hhinv_load_2
           where nvl(error_flg,'N') != 'Y'
           and   road_characteristic = 'I'
           group by he_id;
  if (sqlca.sqlcode < 0)
    sql_err("upd_x_length(2)");

  EXEC SQL create unique index hhinv_temp_7883_ind on hhinv_temp_7883
           (he_id);
        if (sqlca.sqlcode < 0)
                sql_err("upd_x_length(3)");


  EXEC SQL update road_segments rse
           set (rse.rse_length,rse.rse_max_chain)
            = (select decode(nvl(rse.rse_length,0),0,max_chain,rse.rse_length),
                         greatest(nvl(rse.rse_max_chain,0), max_chain)
                  from   hhinv_temp_7883
                  where  he_id = rse.rse_he_id )
           where   rse.rse_type = 'S'
           and   rse.rse_scl_sect_class <> 'NL'
           and   rse.rse_end_date is null
           and   exists
                       (select 1
                        from hhinv_temp_7883
                        where he_id = rse.rse_he_id);

  if (sqlca.sqlcode < 0)
    sql_err("upd_x_length(4)");

  EXEC SQL update road_segments rse
           set rse.rse_last_surveyed = sysdate
           where   rse.rse_type = 'S'
           and   rse.rse_scl_sect_class <> 'NL'
           and   rse.rse_end_date is null
           and   exists
                       (select 1
                        from hhinv_temp_7883
                        where he_id = rse.rse_he_id);
  if (sqlca.sqlcode < 0)
    sql_err("upd_x_length(5)");

  EXEC SQL drop table hhinv_temp_7883;
        if (sqlca.sqlcode < 0)
                sql_err("upd_x_length(6)");


  break;

  case 2 :  /***Oracle/Hims hybrid RMMS database structure ***/

  EXEC SQL update road_sect_ora rse
           set (rse.rse_length,rse.rse_max_chain)
               = (select decode(nvl(rse.rse_length,0),0,
                                max(nvl(hhl2a.end_chain,hhl2a.st_chain)),
                                rse.rse_length),
                         greatest(nvl(rse.rse_max_chain,0),
                                     max(nvl(hhl2a.end_chain,hhl2a.st_chain)))
                  from   hhinv_load_2 hhl2a
                  where  hhl2a.he_id = rse.rse_he_id
                  and    nvl(hhl2a.error_flg,'N') != 'Y')
           where  exists
                       (select 'A'
                        from hhinv_load_2 hhl2b,sctdtail sct
                        where sct.sct_id  = rse.rse_he_id
                        and   sct.date_fn is null
                        and   hhl2b.he_id = rse.rse_he_id
                        and   nvl(hhl2b.error_flg,'N') != 'Y');
  if (sqlca.sqlcode < 0)
    sql_err("upd_x_length(7)");

  break;

  case 1 :  /***Oracle DTp standard RMMS database structure***/
  default:

/* Code below replaced in order to improve performance - see above
  EXEC SQL update road_segments rse
           set (rse.rse_length,rse.rse_max_chain)
               = (select decode(nvl(rse.rse_length,0),0,
                                max(nvl(hhl2a.end_chain,hhl2a.st_chain)),
                                rse.rse_length),
                         greatest(nvl(rse.rse_max_chain,0),
                                     max(nvl(hhl2a.end_chain,hhl2a.st_chain)))
                  from   hhinv_load_2 hhl2a
                  where  hhl2a.he_id = rse.rse_he_id
                  and    nvl(hhl2a.error_flg,'N') != 'Y')
           where   rse.rse_type = 'S'
           and   rse.rse_end_date is null
           and   exists
                       (select 'A'
                        from hhinv_load_2 hhl2b
                        where hhl2b.he_id = rse.rse_he_id
                        and   nvl(hhl2b.error_flg,'N') != 'Y');
                     --------------------------------------------     */

  EXEC SQL create table hhinv_temp_7883
           (he_id number(8), max_chain number);
        if (sqlca.sqlcode < 0)
                sql_err("upd_x_length(8)");

  EXEC SQL insert into hhinv_temp_7883
           select he_id, max(nvl(end_chain, st_chain))
           from hhinv_load_2
           where nvl(error_flg,'N') != 'Y'
           group by he_id;

  if (sqlca.sqlcode < 0)
    sql_err("upd_x_length(9)");

  EXEC SQL create unique index hhinv_temp_7883_ind on hhinv_temp_7883
           (he_id);
        if (sqlca.sqlcode < 0)
                sql_err("upd_x_length(10)");


  EXEC SQL update road_segments rse
           set (rse.rse_length,rse.rse_max_chain)
            = (select decode(nvl(rse.rse_length,0),0,max_chain,rse.rse_length),
                         greatest(nvl(rse.rse_max_chain,0), max_chain)
                  from   hhinv_temp_7883
                  where  he_id = rse.rse_he_id)
           where   rse.rse_type = 'S'
           and   rse.rse_end_date is null
           and   exists
                       (select 1
                        from hhinv_temp_7883
                        where he_id = rse.rse_he_id);
  if (sqlca.sqlcode < 0)
    sql_err("upd_x_length(11)");

  EXEC SQL update road_segments rse
           set rse.rse_last_surveyed = sysdate
           where   rse.rse_type = 'S'
           and   rse.rse_scl_sect_class <> 'NL'
           and   rse.rse_end_date is null
           and   exists
                       (select 1
                        from hhinv_temp_7883
                        where he_id = rse.rse_he_id);
  if (sqlca.sqlcode < 0)
    sql_err("upd_x_length(12)");

  EXEC SQL drop table hhinv_temp_7883;
        if (sqlca.sqlcode < 0)
                sql_err("upd_x_length(13)");


  break;


  } /*END BRACE switch*/

  return((sqlca.sqlcode>=0)?SUCCESS:FATAL);
 }

int upd_last_surveyed()
  {
  EXEC SQL BEGIN DECLARE SECTION;
    int v_error
    ;
  EXEC SQL END DECLARE SECTION;

  v_error = 0;

  EXEC SQL EXECUTE
  DECLARE
    --
    TYPE he_id_tab IS TABLE OF hhinv_sect_log.he_id%TYPE;
    --
    lt_he_id        he_id_tab;
    lt_invent_date  nm3type.tab_varchar30;
    --
    lv_attrib_name nm_inv_type_attribs_all.ita_attrib_name%TYPE;
    lv_iit_ne_id   nm_inv_items_all.iit_ne_id%TYPE;
    lv_string      nm3type.max_varchar2;
    --
  BEGIN
    --
nm_debug.debug_on;
    BEGIN
      --
      SELECT hsl.he_id
            ,to_char(hsl.invent_date,'DD-MON-YYYY')
        BULK COLLECT
        INTO lt_he_id
            ,lt_invent_date
        FROM hhinv_sect_log hsl
       WHERE hsl.lst_run_num = :run_num
         AND NOT EXISTS(SELECT 1
                          FROM hhinv_load_2 hh2
                         WHERE hh2.sect_hdr_seq_no = hsl.rec_seq_no
                           AND NVL(error_flg,'N') = 'Y')
           ;
      --
    EXCEPTION
      WHEN no_data_found
       THEN
          NULL;
      WHEN others
       THEN
          RAISE;
    END;
    --
    FOR i IN 1..lt_he_id.count LOOP
      --
      BEGIN
        --
        SELECT ita_attrib_name
          INTO lv_attrib_name
          FROM nm_inv_type_attribs
         WHERE ita_inv_type = (SELECT nad_inv_type
                                 FROM nm_nw_ad_types
                                WHERE EXISTS(SELECT 1
                                               FROM nm_elements_all
                                              WHERE ne_id = lt_he_id(i)
      				                                  AND ne_nt_type = nad_nt_type
      					                                AND nvl(ne_gty_group_type,'$$$') = nvl(nad_gty_type,'$$$')
    	  				                                AND nad_primary_ad = 'Y'))
           AND UPPER(ita_view_col_name) = 'RSE_LAST_SURVEYED'
             ;
        --
        SELECT nad_iit_ne_id
          INTO lv_iit_ne_id
          FROM nm_nw_ad_link
         WHERE nad_ne_id = lt_he_id(i)
           AND nad_primary_ad = 'Y'
             ;
        --
        lv_string := 'UPDATE nm_inv_items SET '||lv_attrib_name||' = to_date('
                  ||nm3flx.string(lt_invent_date(i))||','||nm3flx.string('DD-MON-YYYY')
                  ||') WHERE iit_ne_id = '||lv_iit_ne_id;
nm_debug.debug(lv_string);
        --
        execute immediate lv_string;
        --
      EXCEPTION
        WHEN others
         THEN
            :v_error := 1;
      END;
      --
    END LOOP;
    --
nm_debug.debug_off;
  EXCEPTION
   WHEN others
    THEN
       :v_error := 1;
  END;
  END-EXEC;

  EXEC SQL WHENEVER SQLERROR do sql_err("update_sect_last_updated(1)");

  if(v_error)
    {
    return(FAIL);
    }
  else
    {
    return(SUCCESS);
    }
  } /* upd_last_surveyed */

int reverse_chainage()
/* *************************************************************************
   Reverses the chainage for inventory on sections recorded in reverse dirn
   ************************************************************************* */
 {

  switch (rmms_flag)
  {

case 3 :  /***Oracle ROMIS database structure***/
case 4 :  /***Welsh Office standard database structure***/

  EXEC SQL update hhinv_load_2 hl2
           set (st_chain,end_chain)
                = (select decode(hl2.end_chain,null,
                                  greatest(rse.rse_max_chain,rse.rse_length)
                                                       - hl2.st_chain,
                                  greatest(rse.rse_max_chain,rse.rse_length)
                                                       - hl2.end_chain),
                          decode(hl2.end_chain,null,null,
                                 greatest(rse.rse_max_chain,rse.rse_length)
                                                       - hl2.st_chain)
                   from   road_segments rse
                   where  rse.rse_he_id = hl2.he_id),
                HL2.X_SECT =
                  (SELECT min(XRV_NEW_XSP)
                   from   xsp_reversal
                   where  xrv_old_xsp = HL2.X_SECT)
           where hl2.sect_hdr_seq_no in
                   (select hsl.rec_seq_no
                    from road_segments_all rsa, hhinv_sect_log hsl
                    where rsa.rse_scl_sect_class <> 'NL'
                    and   rsa.rse_he_id = hsl.he_id
                    and   hsl.direct_run = 'Y'
                    and   hsl.direct_now = 'Y'
                    and   nvl(hsl.error_level,'XXXX') != 'SECT'
                    and   hsl.lst_run_num = :run_num)
           and   nvl(hl2.error_flg,'N') != 'Y'
           and   hl2.full_partial_ind = 'F'
           and   nvl(hl2.road_characteristic,'@') != 'M';
                     break;


  case 2 :  /***Oracle/Hims hybrid RMMS database structure ***/
  EXEC SQL update hhinv_load_2 hl2
          set (st_chain,end_chain)
               = (select decode(hl2.end_chain,null,
                                 greatest(rse.rse_max_chain,rse.rse_length)
                                                      - hl2.st_chain,
                                 greatest(rse.rse_max_chain,rse.rse_length)
                                                      - hl2.end_chain),
                         decode(hl2.end_chain,null,null,
                                greatest(rse.rse_max_chain,rse.rse_length)
                                                      - hl2.st_chain)
                  from   road_sections rse
                  where  rse.rse_he_id = hl2.he_id)
          where hl2.sect_hdr_seq_no in
                  (select hsl.rec_seq_no
                   from hhinv_sect_log hsl
                   where hsl.direct_run = 'Y'
                   and   hsl.direct_now = 'Y'
                   and   nvl(hsl.error_level,'XXXX') != 'SECT'
                   and   hsl.lst_run_num = :run_num)
          and   nvl(hl2.error_flg,'N') != 'Y'
          and   nvl(hl2.road_characteristic,'@') != 'M';
          break;

  case 1 :  /***Oracle DTp standard RMMS database structure***/
  default:

  EXEC SQL update hhinv_load_2 hl2
           set (st_chain,end_chain)
                = (select decode(hl2.end_chain,null,
                                  greatest(rse.rse_max_chain,rse.rse_length)
                                                       - hl2.st_chain,
                                  greatest(rse.rse_max_chain,rse.rse_length)
                                                       - hl2.end_chain),
                          decode(hl2.end_chain,null,null,
                                 greatest(rse.rse_max_chain,rse.rse_length)
                                                       - hl2.st_chain)
                   from   road_segments rse
                   where  rse.rse_he_id = hl2.he_id)
           where hl2.sect_hdr_seq_no in
                   (select hsl.rec_seq_no
                    from hhinv_sect_log hsl
                    where hsl.direct_run = 'Y'
                    and   hsl.direct_now = 'Y'
                    and   nvl(hsl.error_level,'XXXX') != 'SECT'
                    and   hsl.lst_run_num = :run_num)
           and   nvl(hl2.error_flg,'N') != 'Y'
           and   nvl(hl2.road_characteristic,'@') != 'M';
                     break;


  } /*END BRACE switch*/

  if (sqlca.sqlcode < 0)
    sql_err("reverse_chainage(1)");

  EXEC SQL update hhinv_sect_log hsl
           set   hsl.direct_now = 'N'
           where hsl.direct_run = 'Y'
           and   hsl.direct_now = 'Y'
           and   nvl(hsl.error_level,'XXXX') != 'SECT'
           and   hsl.lst_run_num = :run_num;

  if (sqlca.sqlcode < 0)
    sql_err("reverse_chainage(2)");
  else
      return(SUCCESS);
 }

 check_first_sub_section()
 {
    EXEC SQL whenever sqlerror goto chk_sub_sect_err;
    EXEC SQL whenever sqlwarning goto chk_sub_sect_err;

    EXEC SQL update hhinv_load_2 h2
               set h2.error_msg = 'First Sub Section Invalid',
                   h2.error_flg = 'Y'
             where (h2.x_sect, h2.inv_code) in
                     (select h3.x_sect, h3.inv_code
                        from hhinv_load_2 h3,
                             road_sections rse
                       where h3.he_id = h2.he_id
                         and h3.end_chain =
                               (select min(h4.end_chain)
                                  from hhinv_load_2 h4
                                 where h4.he_id = h3.he_id
                                   and h4.x_sect = h3.x_sect)
                         and h3.x_sect = h2.x_sect
                         and h3.inv_code = h2.inv_code
                         and rse.rse_he_id = h3.he_id
                         and h3.end_chain - h3.st_chain !=
                               h3.sub_section_length)
                         and h2.inv_code in
                               (select utst.utst_inv_code
                                  from ukpms_t1_survey_types utst,
                                       ukpms_view_definitions
                                 where utst.utst_fit_method = 'C'
                                   and utst.utst_sys_flag = h2.hhinv_ity_sys_flag
                                   and uvd_ukpms_code = utst_survey_type
                                   and uvd_xsp_method_in_use = 'U')
                           ;
    return(SUCCESS);

    chk_sub_sect_err:
      sql_err("check_first_sub_section");
      return(FATAL);
 }

 check_sub_section()
 {
    EXEC SQL whenever sqlerror goto sub_sect_err;
    EXEC SQL whenever sqlwarning continue;

    EXEC SQL update hhinv_load_2 h2
                set h2.error_msg = 'Survey short by >1 Sub Section Length',
                    h2.error_flg = 'Y'
              where (h2.x_sect, h2.inv_code) in
                      (select h3.x_sect, h3.inv_code
                         from hhinv_load_2 h3,
                              road_sections rse
                        where h3.he_id = h2.he_id
                          and h3.end_chain =
                                (select max(h4.end_chain)
                                   from hhinv_load_2 h4
                                  where h4.he_id = h3.he_id
                                    and h4.x_sect = h3.x_sect)
                and h3.x_sect = h2.x_sect
                and h3.inv_code = h2.inv_code
                and rse.rse_he_id = h3.he_id
                and rse.rse_length - h3.end_chain >
                      h3.sub_section_length)
                and h2.full_partial_ind = 'F'
                and h2.inv_code in
                      (select utst.utst_inv_code
                         from ukpms_t1_survey_types utst,
                              ukpms_view_definitions
                        where utst.utst_fit_method = 'C'
                          and utst.utst_sys_flag = h2.hhinv_ity_sys_flag
                          and uvd_ukpms_code = utst_survey_type
                          and uvd_xsp_method_in_use = 'U')
                  ;

    EXEC SQL update hhinv_load_2 h2
                set h2.error_msg = 'Survey long by >1 Sub Section Length',
                    h2.error_flg = 'Y'
              where (h2.x_sect, h2.inv_code) in
                      (select h3.x_sect, h3.inv_code
                         from hhinv_load_2 h3,
                              road_sections rse
                        where h3.he_id = h2.he_id
                          and h3.end_chain =
                                (select max(h4.end_chain)
                                   from hhinv_load_2 h4
                                  where h4.he_id = h3.he_id
                                    and h4.x_sect = h3.x_sect)
                          and h3.x_sect = h2.x_sect
                          and h3.inv_code = h2.inv_code
                          and rse.rse_he_id = h3.he_id
                          and h3.end_chain > h3.sub_section_length + rse.rse_length
                      )
                and h2.full_partial_ind = 'F'
                and h2.inv_code in
                      (select utst.utst_inv_code
                         from ukpms_t1_survey_types utst,
                              ukpms_view_definitions
                        where utst.utst_fit_method = 'C'
                          and utst.utst_sys_flag = h2.hhinv_ity_sys_flag
                          and uvd_ukpms_code = utst_survey_type
                          and uvd_xsp_method_in_use = 'U')
                  ;
 /*
           and  h2.inv_code in ('DE');
 */

    EXEC SQL update hhinv_sect_log hsl
            SET    SUCCESS_STAT = 2,
                   ERROR_LEVEL  = 'SECT',
                   ERROR_MSG    = 'Survey short by >1 Sub Section Length'
            where  hsl.he_id in
              (select hl2.he_id
               from hhinv_load_2 hl2
               where hl2.error_msg = 'Survey short by >1 Sub Section Length'
               and   hl2.error_flg = 'Y')
            and   hsl.lst_run_num = :run_num;

    EXEC SQL update hhinv_sect_log hsl
            SET    SUCCESS_STAT = 2,
                   ERROR_LEVEL  = 'SECT',
                   ERROR_MSG    = 'Survey long by >1 Sub Section Length'
            where  hsl.he_id in
              (select hl2.he_id
               from hhinv_load_2 hl2
               where hl2.error_msg = 'Survey long by >1 Sub Section Length'
               and   hl2.error_flg = 'Y')
            and   hsl.lst_run_num = :run_num;


    return(SUCCESS);

    sub_sect_err:
      sql_err("check_sub_section");
      return(FATAL);
 }



    EXEC SQL WHENEVER sqlerror continue;
    EXEC SQL WHENEVER sqlwarning continue;

 truncate_survey()
 {
    EXEC SQL WHENEVER SQLERROR goto trunc_surv_err;
    EXEC SQL WHENEVER SQLWARNING goto trunc_surv_err;



    EXEC SQL UPDATE HHINV_LOAD_2 HHL2B
                set hhl2b.end_chain =
                      (select rse.rse_length
                         from road_sections rse
                        where rse.rse_he_id = hhl2b.he_id)
                   ,hhl2b.st_chain = mai.calc_st_chain(hhl2b.st_chain, hhl2b.end_chain, hhl2b.he_id)
              where hhl2b.end_chain >
                      (select rse.rse_length
                         from road_Sections rse
                        where rse.rse_he_id = hhl2b.he_id)
                and hhl2b.inv_code in
                      (select utst_inv_code
                         from ukpms_t1_survey_types,
                              ukpms_view_definitions
                        where utst_fit_method = 'C'
                          and utst_sys_flag   = hhl2b.hhinv_ity_sys_flag
                          and uvd_ukpms_code  = utst_survey_type
                          and uvd_xsp_method_in_use = 'U')
                  ;
 return (SUCCESS);

  trunc_surv_err:
   sql_err("truncate_survey");
   return(FATAL);
 }

 get_seq_no()
 {

/* ------------------------------------------------------------------
*   MRE. 15-May-01. Sequence will no longer be used.
*
*   EXEC SQL whenever sqlerror continue;
*   EXEC SQL whenever sqlwarning continue;
*
*   EXEC SQL drop sequence next_seq;
** ------------------------------------------------------------------ */

    EXEC SQL whenever sqlerror goto get_seq_no_err;
    EXEC SQL whenever sqlwarning goto get_seq_no_err;

    EXEC SQL select max(max_seq_no)+10
             into :i_next_seq
             from hhinv_sect_log;

/* ------------------------------------------------------------------
*   MRE. 15-May-01. Sequence will no longer be used.
*   EXEC SQL create sequence next_seq;
** ------------------------------------------------------------------ */

    return(SUCCESS);

   get_seq_no_err:
     sql_err("get_seq_no");
     return(FATAL);
 }

end_date_old_inv()
{
  int eof_inv = 0;
  EXEC SQL WHENEVER SQLERROR goto :end_date_err;
  EXEC SQL WHENEVER SQLWARNING goto :end_date_err;

  eof_inv = get_inv_to_end_date();
  while (!eof_inv)
    {
      EXEC
       SQL
    UPDATE nm_inv_items_all
       SET iit_end_date = to_date(:inv_invent_date,'YYYYMMDD')
     WHERE iit_end_date is null
       AND iit_inv_type = mai.translate_mai_inv_type(:inv_inv_type)
       AND iit_ne_id in(SELECT nm_ne_id_in  /* Section Is A Group Of ESU Datums  */
                          FROM nm_members   /* With Assets Located On The ESUs   */
                         WHERE nm_type = 'I'
                           AND nm_ne_id_of in(SELECT nm_ne_id_of
                                                FROM nm_members_all
                                               WHERE nm_ne_id_in = :inv_he_id)
                         UNION
                        SELECT nm_ne_id_in  /* Section Is A Datum                  */
                          FROM nm_members   /* With Assets Located On The Sections */
                         WHERE nm_type = 'I'
                           AND nm_ne_id_of = :inv_he_id)
         ;
    eof_inv = get_inv_to_end_date();
    }
  EXEC SQL WHENEVER SQLERROR continue;
  EXEC SQL WHENEVER SQLWARNING continue;
  return(SUCCESS);

end_date_err:
  sql_err("end_date_old_inv");
  return(FATAL);
}

int get_inv_to_end_date()
{
  static int first_time= 1, till_now, this_time, where;

  if(first_time)
    {
    first_time = 0;
    till_now   = 0;
    this_time  = 100;
    where      = 100;

    EXEC SQL DECLARE C_ITEMS CURSOR
          FOR SELECT distinct he_id
                    ,to_char(invent_date,'YYYYMMDD')
                    ,inv_code
                FROM hhinv_load_2
                    ,inv_item_types
               WHERE ity_close_existing  = 'Y'
                 AND ity_inv_code        = inv_code
                 AND ity_sys_flag        = hhinv_ity_sys_flag
                 AND NVL(error_flg,'N') != 'Y'
                 AND full_partial_ind    = 'F'
                   ;
    EXEC SQL OPEN C_ITEMS;
    }

  if(this_time == where)
    {
    if(this_time < 100)             /* Last FETCH reached EOR */
      {
      EXEC SQL CLOSE C_ITEMS;
      first_time = 1;
      return(EOF);
      }

    EXEC SQL FETCH C_ITEMS
              INTO :r_inv_he_id
                  ,:r_inv_invent_date
                  ,:r_inv_inv_type
                  ;

    this_time = sqlca.sqlerrd[2] - till_now;
    till_now += this_time;
    where = 0;
    if(this_time == 0)              /* This FETCH was reading nothing */
      {
      EXEC SQL CLOSE C_ITEMS;
      first_time = 1;
      return(EOF);
      }
    }

  inv_he_id = r_inv_he_id[where];
  inv_invent_date = r_inv_invent_date[where];

  r_inv_inv_type[where].arr[r_inv_inv_type[where].len] = '\0';
  strcpy((char*)inv_inv_type.arr, (char*)r_inv_inv_type[where].arr);
  inv_inv_type.len = r_inv_inv_type[where].len;

  where++;

  return(SUCCESS);

end_date_err:
  sql_err("get_inv_to_end_date");
  return(FATAL);
} /* get_inv_to_end_date */

 int create_sub_section()
 {
    EXEC SQL WHENEVER SQLERROR goto :cr_sub_sect_err;
    EXEC SQL WHENEVER SQLWARNING continue;

    EXEC SQL delete temp_load_2;

    EXEC SQL insert
               into temp_load_2
                    (
                    sect_hdr_seq_no,
                    he_id,
                    linkcode,
                    section_code,
                    inv_code,
                    st_chain,
                    end_chain,
                    road_characteristic,
                    hhinv_survey_direction,
                    survey_length,
                    survey_tolerance,
                    sub_section_length,
                    full_partial_ind,
                    error_flg,
                    peo_invent_by_id,
                    invent_date,
                    scl_class,
                    x_sect,
                    hhinv_ity_sys_flag,
                    hhfld1,
                    hhattr1,
                    hhfld2,
                    hhattr2,
                    hhfld3,
                    hhattr3,
                    hhfld5,
                    hhattr5
                    )
             select distinct hl2.sect_hdr_seq_no,
                    hl2.he_id,
                    hl2.linkcode,
                    hl2.section_code,
                    hl2.inv_code,
                    hl2.end_chain,
                    rse.rse_length,
                    hl2.road_characteristic,
                    hl2.hhinv_survey_direction,
                    hl2.survey_length,
                    hl2.survey_tolerance,
                    hl2.sub_section_length,
                    hl2.full_partial_ind,
                    hl2.error_flg,
                    hl2.peo_invent_by_id,
                    hl2.invent_date,
                    hl2.scl_class,
                    hl2.x_sect,
                    hl2.hhinv_ity_sys_flag,
                    'CL1',
                    'DET_XSP',
                    ' ',
                    'NUM_ATTRIB19',
                    utst_fit_defect_code,
                    'CHR_ATTRIB26',
                    utst_fit_value,
                    'NUM_ATTRIB17'
               from road_Sections rse,
                    hhinv_load_2 hl2,
                    ukpms_t1_survey_types utst,
                    ukpms_view_definitions uvd
              where rse.rse_length > hl2.end_chain
                and rse.rse_length - hl2.end_chain < hl2.sub_section_length
                and hl2.he_id = rse.rse_he_id
                and hl2.he_id is not null
                and hl2.end_chain =
                      (select max(hl3.end_chain)
                         from hhinv_load_2 hl3
                        where hl3.he_id = hl2.he_id
                          and hl3.inv_code = hl2.inv_code)
                and utst.utst_inv_code = hl2.inv_code
                and utst.utst_sys_flag = hl2.hhinv_ity_sys_flag
                and utst.utst_fit_method = 'C'
                and uvd.uvd_ukpms_code = utst.utst_survey_type
                and uvd.uvd_xsp_method_in_use = 'U'
                  ;

    return(SUCCESS);

    cr_sub_sect_err:
       sql_err("create_sub_section");
       return(FATAL);
 }

 int add_sub_section()
 {
    EXEC SQL WHENEVER SQLERROR goto :sub_sect_err;
    EXEC SQL WHENEVER SQLWARNING goto :sub_sect_err;

    EXEC SQL insert into hhinv_load_2
        (rec_seq_no,
         sect_hdr_seq_no,
         he_id,
         linkcode,
         section_code,
         inv_code,
         st_chain,
         end_chain,
         road_characteristic,
         hhinv_survey_direction,
         survey_length,
         survey_tolerance,
         sub_section_length,
         full_partial_ind,
          error_flg,
         peo_invent_by_id,
         invent_date,
         scl_class,
         x_sect,
         hhinv_ity_sys_flag,
         hhfld1,
         hhattr1,
         hhfld2,
         hhattr2,
         hhfld3,
         hhattr3,
         hhfld5,
         hhattr5)
     select
-- ---------------------------------------------------------------
-- MRE. 15-May-01. Use ROWNUM instead of the sequence.
--       next_seq.nextval + :i_next_seq,
-- ---------------------------------------------------------------
        ROWNUM + :i_next_seq,
        hl2.sect_hdr_seq_no,
        hl2.he_id,
        hl2.linkcode,
        hl2.section_code,
        hl2.inv_code,
        hl2.st_chain,
        hl2.end_chain,
        hl2.road_characteristic,
        hl2.hhinv_survey_direction,
        hl2.survey_length,
        hl2.survey_tolerance,
        hl2.sub_section_length,
        hl2.full_partial_ind,
        hl2.error_flg,
        hl2.peo_invent_by_id,
        hl2.invent_date,
        hl2.scl_class,
        hl2.x_sect,
        hl2.hhinv_ity_sys_flag,
        hl2.hhfld1,
        hl2.hhattr1,
        hl2.hhfld2,
        hl2.hhattr2,
        hl2.hhfld3,
        hl2.hhattr3,
        hl2.hhfld5,
        hl2.hhattr5
     from  temp_load_2 hl2;


 return (SUCCESS);

  sub_sect_err:
  sql_err("add_sub_section");
  return(FATAL);
}

inc_sect_log()
{

  EXEC SQL WHENEVER SQLERROR continue;
  EXEC SQL WHENEVER SQLWARNING continue;

  EXEC SQL update hhinv_sect_log
    set max_seq_no = max_seq_no + 1;

  return(SUCCESS);

  inc_sect_log:
    sql_err("inc_sect_log");
    return(FATAL);
}




int ck_chain()
/* ************************************************************************
   Marks all inv items where Start Chain greater than End chain
   ************************************************************************* */
 {

  EXEC SQL UPDATE HHINV_LOAD_2 HHL2
           SET    ERROR_MSG = 'Start Chainage Greater than End',
                  ERROR_FLG = 'Y'
           WHERE  HHL2.END_CHAIN < HHL2.ST_CHAIN
           AND    ERROR_FLG IS NULL;

  if (sqlca.sqlcode < 0)
    sql_err("ck_chain");

  switch (rmms_flag)
  {
  case 3 :
  case 4 :

    /*  This Maint Mgr code altered to cater for null XSP's on NLA's 02-Nov-92  */

    /*********************************************/
    /* SQL Below has been replaced for version 3 */
    /* Changed xsr_ity_sys_flag To xsr_nw_type   */
    /*********************************************/
/*
    EXEC SQL update hhinv_load_2 hhl2
                set error_msg = 'Not a valid XSP Position'
                   ,error_flg = 'Y'
              where not (exists(select 'A'
                                  from road_segments_all
                                      ,xsp_restraints
                                 where rse_scl_sect_class <> 'NL'
                                   and hhl2.he_id = rse_he_id
                                   and hhl2.inv_code = xsr_ity_inv_code
                                   and hhl2.x_sect   = xsr_x_sect_value
                                   and hhl2.scl_class = xsr_scl_class
                                   and hhl2.hhinv_ity_sys_flag = xsr_ity_sys_flag)
                         or  hhl2.x_sect is null
                         and (exists(select null
                                       from inv_item_types
                                      where ity_x_sect_allow_flag = 'N'
                                        and hhl2.inv_code = ity_inv_code
                                        and hhl2.hhinv_ity_sys_flag = ity_sys_flag)
                              or  exists (select 1
                                            from road_segments_all
                                           where rse_he_id = hhl2.he_id
                                             and rse_scl_sect_class = 'NL')))
                  ;
*/
    EXEC SQL update hhinv_load_2 hhl2
                set error_msg = 'Not a valid XSP Position'
                   ,error_flg = 'Y'
              where not (exists(select 'A'
                                  from road_segments_all
                                      ,inv_type_translations
                                      ,xsp_restraints
                                 where xsr_scl_class    = hhl2.scl_class
                                   and xsr_x_sect_value = hhl2.x_sect
                                   and xsr_nw_type      = ity_dtp_flag
                                   and xsr_ity_inv_code = nit_inv_type
                                   and ity_inv_code     = hhl2.inv_code
                                   and ity_dtp_flag     = hhl2.hhinv_ity_sys_flag
                                   and rse_he_id        = hhl2.he_id
                                   and rse_scl_sect_class <> 'NL')
                         or  hhl2.x_sect is null
                         and (exists(select null
                                       from inv_item_types
                                      where ity_x_sect_allow_flag = 'N'
                                        and hhl2.inv_code = ity_inv_code
                                        and hhl2.hhinv_ity_sys_flag = ity_sys_flag)
                              or exists(select 1
                                          from road_segments_all
                                         where rse_he_id = hhl2.he_id
                                           and rse_scl_sect_class = 'NL')))
                  ;
    break;
  default:
  EXEC SQL update hhinv_load_2 hhl2
           set error_msg = 'Not a valid XSP Position',
               error_flg = 'Y'
           where not (exists
                           (select 'A'
                            from   xsp_restraints
                            where  hhl2.inv_code = xsr_ity_inv_code
                            and    hhl2.x_sect   = xsr_x_sect_value
                            and    hhl2.scl_class = xsr_scl_class)
           or  (    hhl2.x_sect is null
               and exists (select null
                           from inv_item_types
                           where ity_x_sect_allow_flag = 'N'
                           and   hhl2.inv_code = ity_inv_code)));
   ;
   }

  if (sqlca.sqlcode < 0)
    sql_err("ck_chain(2)");
  else
      return(SUCCESS);
 }


int check_point_cont()
{
  switch (rmms_flag)
  {
  case 3 :
  case 4 :
           EXEC SQL UPDATE HHINV_LOAD_2 HHL2
                       SET ERROR_MSG = 'Point Item with unequal Chainage',
                           ERROR_FLG = 'Y'
                     WHERE exists(SELECT 'A'
                                    FROM INV_ITEM_TYPES ITY
                                   WHERE HHL2.INV_CODE     =  ITY.ITY_INV_CODE
                                     AND HHL2.HHINV_ITY_SYS_FLAG = ITY.ITY_SYS_FLAG
                                     AND ITY.ITY_pnt_or_cont    =  'P' )
                       AND HHL2.END_CHAIN !=  HHL2.ST_CHAIN
                       AND hhl2.ERROR_FLG IS NULL
                         ;
           break;
  default:
           EXEC SQL UPDATE HHINV_LOAD_2 HHL2
                       SET ERROR_MSG = 'Point Asset With Unequal Chainage',
                           ERROR_FLG = 'Y'
                     WHERE exists(SELECT 'A'
                                    FROM INV_ITEM_TYPES ITY
                                   WHERE  HHL2.INV_CODE     =  ITY.ITY_INV_CODE
                                     AND    ITY.ITY_pnt_or_cont    =  'P' )
                       AND HHL2.END_CHAIN !=  HHL2.ST_CHAIN
                       AND hhl2.ERROR_FLG IS NULL
                         ;
  }
  /*-----------------------------------------*/
  /* Update Below Added For NM3, Continuous  */
  /* Items May NOT Have The Same Start And   */
  /* End Chainage In NM3.                    */
  /*-----------------------------------------*/
  EXEC SQL UPDATE hhinv_load_2 hhl2
              SET error_msg = 'Continuous Asset Cannot Have Start And End Points That Are The Same.'
                 ,error_flg = 'Y'
            WHERE EXISTS(SELECT 'A'
                           FROM inv_item_types ity
                          WHERE hhl2.inv_code = ity.ity_inv_code
                            AND ity.ity_pnt_or_cont =  'C')
              AND hhl2.st_chain = hhl2.end_chain
              AND hhl2.error_flg IS NULL
                ;

  if(sqlca.sqlcode < 0)
    sql_err("check_point_cont");
  else
    return(SUCCESS);
}


int pull_off_inv_bad()
/* *************************************************************************
   Pulls out all inv_items flagged  as in error. This includes all
   items with their own errors and those identified at section level
   ************************************************************************* */
 {

  switch (rmms_flag)
  {
  case 1:
  case 3:
  case 4:
  EXEC SQL INSERT INTO HHINV_ITEM_ERR_2
                  ( RUN_NUM,REC_SEQ_NO,SECT_HDR_SEQ_NO,HE_ID,SCL_CLASS,
                    LINKCODE, SECTION_CODE,INV_CODE,PEO_INVENT_BY_ID,
                    INVENT_DATE, survey_length, hhinv_survey_direction,
                    sub_section_length, full_partial_ind,
                    X_SECT,ST_CHAIN,END_CHAIN,ROAD_CHARACTERISTIC,HHFLD1,
                    HHATTR1,HHFLD2,HHATTR2,HHFLD3,HHATTR3,HHFLD4,HHATTR4,
                    HHFLD5,HHATTR5,HHFLD6,HHATTR6,HHFLD7,HHATTR7,
                    HHFLD8,HHATTR8,HHFLD9,HHATTR9,HHFLD10,HHATTR10,
                    HHFLD11,HHATTR11,HHFLD12,HHATTR12,HHFLD13,HHATTR13,
                    HHFLD14,HHATTR14,HHFLD15,HHATTR15,
                    HHFLD16,HHATTR16,HHFLD17,HHATTR17,HHFLD18,HHATTR18,
                    HHFLD19,HHATTR19,HHFLD20,HHATTR20,HHFLD21,HHATTR21,
                    HHFLD22,HHATTR22,HHFLD23,HHATTR23,HHFLD24,HHATTR24,
                    HHFLD25,HHATTR25,HHFLD26,HHATTR26,HHFLD27,HHATTR27,
                    HHFLD28,HHATTR28,HHFLD29,HHATTR29,HHFLD30,HHATTR30,
                    HHFLD31,HHATTR31,HHFLD32,HHATTR32,HHFLD33,HHATTR33,
                    HHFLD34,HHATTR34,HHFLD35,HHATTR35,HHFLD36,HHATTR36,
                    HHFLD37,HHATTR37,HHFLD38,HHATTR38,HHFLD39,HHATTR39,
                    HHFLD40,HHATTR40,HHFLD41,HHATTR41,HHFLD42,HHATTR42,
                    HHFLD43,HHATTR43,HHFLD44,HHATTR44,HHFLD45,HHATTR45,
                    HHFLD46,HHATTR46,HHFLD47,HHATTR47,HHFLD48,HHATTR48,
                    HHFLD49,HHATTR49,HHFLD50,HHATTR50,HHFLD51,HHATTR52,
                    HHFLD53,HHATTR53,HHFLD54,HHATTR54,HHFLD55,HHATTR55,
                    HHFLD56,HHATTR56,HHFLD57,HHATTR57,HHFLD58,HHATTR58,
                    HHFLD59,HHATTR59,HHFLD60,HHATTR60,HHFLD61,HHATTR61,
                    HHFLD62,HHATTR62,HHFLD63,HHATTR63,HHFLD64,HHATTR64,
                    HHFLD65,HHATTR65,HHFLD66,HHATTR66,HHFLD67,HHATTR67,
                    HHFLD68,HHATTR68,HHFLD69,HHATTR69,HHFLD70,HHATTR70,
                    HHFLD71,HHATTR71,HHFLD72,HHATTR72,HHFLD73,HHATTR73,
                    HHFLD74,HHATTR74,HHFLD75,HHATTR75,
                    ERROR_MSG,HHINV_ITY_SYS_FLAG )
            SELECT  :run_num,REC_SEQ_NO,SECT_HDR_SEQ_NO,HE_ID,SCL_CLASS,
                    LINKCODE, SECTION_CODE,INV_CODE,PEO_INVENT_BY_ID,
                    INVENT_DATE, survey_length, hhinv_survey_direction,
                    sub_section_length, full_partial_ind,
                    X_SECT,ST_CHAIN,END_CHAIN,ROAD_CHARACTERISTIC,
                    HHFLD1,HHATTR1,HHFLD2,HHATTR2,HHFLD3,HHATTR3,HHFLD4,
                    HHATTR4,HHFLD5,HHATTR5,HHFLD6,HHATTR6,HHFLD7,HHATTR7,
                    HHFLD8,HHATTR8,HHFLD9,HHATTR9,HHFLD10,HHATTR10,
                    HHFLD11,HHATTR11,HHFLD12,HHATTR12,HHFLD13,HHATTR13,
                    HHFLD14,HHATTR14,HHFLD15,HHATTR15,
                    HHFLD16,HHATTR16,HHFLD17,HHATTR17,HHFLD18,HHATTR18,
                    HHFLD19,HHATTR19,HHFLD20,HHATTR20,HHFLD21,HHATTR21,
                    HHFLD22,HHATTR22,HHFLD23,HHATTR23,HHFLD24,HHATTR24,
                    HHFLD25,HHATTR25,HHFLD26,HHATTR26,HHFLD27,HHATTR27,
                    HHFLD28,HHATTR28,HHFLD29,HHATTR29,HHFLD30,HHATTR30,
                    HHFLD31,HHATTR31,HHFLD32,HHATTR32,HHFLD33,HHATTR33,
                    HHFLD34,HHATTR34,HHFLD35,HHATTR35,HHFLD36,HHATTR36,
                    HHFLD37,HHATTR37,HHFLD38,HHATTR38,HHFLD39,HHATTR39,
                    HHFLD40,HHATTR40,HHFLD41,HHATTR41,HHFLD42,HHATTR42,
                    HHFLD43,HHATTR43,HHFLD44,HHATTR44,HHFLD45,HHATTR45,
                    HHFLD46,HHATTR46,HHFLD47,HHATTR47,HHFLD48,HHATTR48,
                    HHFLD49,HHATTR49,HHFLD50,HHATTR50,HHFLD51,HHATTR52,
                    HHFLD53,HHATTR53,HHFLD54,HHATTR54,HHFLD55,HHATTR55,
                    HHFLD56,HHATTR56,HHFLD57,HHATTR57,HHFLD58,HHATTR58,
                    HHFLD59,HHATTR59,HHFLD60,HHATTR60,HHFLD61,HHATTR61,
                    HHFLD62,HHATTR62,HHFLD63,HHATTR63,HHFLD64,HHATTR64,
                    HHFLD65,HHATTR65,HHFLD66,HHATTR66,HHFLD67,HHATTR67,
                    HHFLD68,HHATTR68,HHFLD69,HHATTR69,HHFLD70,HHATTR70,
                    HHFLD71,HHATTR71,HHFLD72,HHATTR72,HHFLD73,HHATTR73,
                    HHFLD74,HHATTR74,HHFLD75,HHATTR75,
                    ERROR_MSG,HHINV_ITY_SYS_FLAG
            FROM    HHINV_LOAD_2 HHL2
            WHERE   ERROR_FLG = 'Y'
              AND   NOT EXISTS(SELECT 1
                                 FROM HHINV_ITEM_ERR_2 HHIE2
                                WHERE RUN_NUM = :run_num
                                  AND HHIE2.REC_SEQ_NO = HHL2.REC_SEQ_NO)
                ;
       break;
   default:
   EXEC SQL INSERT INTO HHINV_ITEM_ERR_2
                  ( RUN_NUM,REC_SEQ_NO,SECT_HDR_SEQ_NO,HE_ID,SCL_CLASS,
                    LINKCODE, SECTION_CODE,INV_CODE,PEO_INVENT_BY_ID,
                    INVENT_DATE, survey_length,
                    X_SECT,ST_CHAIN,END_CHAIN,ROAD_CHARACTERISTIC,
                    HHFLD1,HHATTR1,HHFLD2,HHATTR2,HHFLD3,HHATTR3,HHFLD4,
                    HHATTR4,HHFLD5,HHATTR5,HHFLD6,HHATTR6,HHFLD7,HHATTR7,
                    HHFLD8,HHATTR8,HHFLD9,HHATTR9,HHFLD10,HHATTR10,
                    HHFLD11,HHATTR11,HHFLD12,HHATTR12,HHFLD13,HHATTR13,
                    HHFLD14,HHATTR14,HHFLD15,HHATTR15,
                    HHFLD16,HHATTR16,HHFLD17,HHATTR17,HHFLD18,HHATTR18,
                    HHFLD19,HHATTR19,HHFLD20,HHATTR20,HHFLD21,HHATTR21,
                    HHFLD22,HHATTR22,HHFLD23,HHATTR23,HHFLD24,HHATTR24,
                    HHFLD25,HHATTR25,HHFLD26,HHATTR26,HHFLD27,HHATTR27,
                    HHFLD28,HHATTR28,HHFLD29,HHATTR29,HHFLD30,HHATTR30,
                    HHFLD31,HHATTR31,HHFLD32,HHATTR32,HHFLD33,HHATTR33,
                    HHFLD34,HHATTR34,HHFLD35,HHATTR35,HHFLD36,HHATTR36,
                    HHFLD37,HHATTR37,HHFLD38,HHATTR38,HHFLD39,HHATTR39,
                    HHFLD40,HHATTR40,HHFLD41,HHATTR41,HHFLD42,HHATTR42,
                    HHFLD43,HHATTR43,HHFLD44,HHATTR44,HHFLD45,HHATTR45,
                    HHFLD46,HHATTR46,HHFLD47,HHATTR47,HHFLD48,HHATTR48,
                    HHFLD49,HHATTR49,HHFLD50,HHATTR50,HHFLD51,HHATTR52,
                    HHFLD53,HHATTR53,HHFLD54,HHATTR54,HHFLD55,HHATTR55,
                    HHFLD56,HHATTR56,HHFLD57,HHATTR57,HHFLD58,HHATTR58,
                    HHFLD59,HHATTR59,HHFLD60,HHATTR60,HHFLD61,HHATTR61,
                    HHFLD62,HHATTR62,HHFLD63,HHATTR63,HHFLD64,HHATTR64,
                    HHFLD65,HHATTR65,HHFLD66,HHATTR66,HHFLD67,HHATTR67,
                    HHFLD68,HHATTR68,HHFLD69,HHATTR69,HHFLD70,HHATTR70,
                    HHFLD71,HHATTR71,HHFLD72,HHATTR72,HHFLD73,HHATTR73,
                    HHFLD74,HHATTR74,HHFLD75,HHATTR75,
                    ERROR_MSG )
            SELECT  :run_num,REC_SEQ_NO,SECT_HDR_SEQ_NO,HE_ID,SCL_CLASS,
                    LINKCODE, SECTION_CODE,INV_CODE,PEO_INVENT_BY_ID,
                    INVENT_DATE, survey_length,
                    X_SECT,ST_CHAIN,END_CHAIN,ROAD_CHARACTERISTIC,
                    HHFLD1,HHATTR1,HHFLD2,HHATTR2,HHFLD3,HHATTR3,HHFLD4,
                    HHATTR4,HHFLD5,HHATTR5,HHFLD6,HHATTR6,HHFLD7,HHATTR7,
                    HHFLD8,HHATTR8,HHFLD9,HHATTR9,HHFLD10,HHATTR10,
                    HHFLD11,HHATTR11,HHFLD12,HHATTR12,HHFLD13,HHATTR13,
                    HHFLD14,HHATTR14,HHFLD15,HHATTR15,
                    HHFLD16,HHATTR16,HHFLD17,HHATTR17,HHFLD18,HHATTR18,
                    HHFLD19,HHATTR19,HHFLD20,HHATTR20,HHFLD21,HHATTR21,
                    HHFLD22,HHATTR22,HHFLD23,HHATTR23,HHFLD24,HHATTR24,
                    HHFLD25,HHATTR25,HHFLD26,HHATTR26,HHFLD27,HHATTR27,
                    HHFLD28,HHATTR28,HHFLD29,HHATTR29,HHFLD30,HHATTR30,
                    HHFLD31,HHATTR31,HHFLD32,HHATTR32,HHFLD33,HHATTR33,
                    HHFLD34,HHATTR34,HHFLD35,HHATTR35,HHFLD36,HHATTR36,
                    HHFLD37,HHATTR37,HHFLD38,HHATTR38,HHFLD39,HHATTR39,
                    HHFLD40,HHATTR40,HHFLD41,HHATTR41,HHFLD42,HHATTR42,
                    HHFLD43,HHATTR43,HHFLD44,HHATTR44,HHFLD45,HHATTR45,
                    HHFLD46,HHATTR46,HHFLD47,HHATTR47,HHFLD48,HHATTR48,
                    HHFLD49,HHATTR49,HHFLD50,HHATTR50,HHFLD51,HHATTR52,
                    HHFLD53,HHATTR53,HHFLD54,HHATTR54,HHFLD55,HHATTR55,
                    HHFLD56,HHATTR56,HHFLD57,HHATTR57,HHFLD58,HHATTR58,
                    HHFLD59,HHATTR59,HHFLD60,HHATTR60,HHFLD61,HHATTR61,
                    HHFLD62,HHATTR62,HHFLD63,HHATTR63,HHFLD64,HHATTR64,
                    HHFLD65,HHATTR65,HHFLD66,HHATTR66,HHFLD67,HHATTR67,
                    HHFLD68,HHATTR68,HHFLD69,HHATTR69,HHFLD70,HHATTR70,
                    HHFLD71,HHATTR71,HHFLD72,HHATTR72,HHFLD73,HHATTR73,
                    HHFLD74,HHATTR74,HHFLD75,HHATTR75,
                    ERROR_MSG
            FROM    HHINV_LOAD_2 HHL2
            WHERE   ERROR_FLG = 'Y'
              AND   NOT EXISTS(SELECT 1
                                 FROM HHINV_ITEM_ERR_2 HHIE2
                                WHERE RUN_NUM = :run_num
                                  AND HHIE2.REC_SEQ_NO = HHL2.REC_SEQ_NO)
                ;
   ;
   }

  if (sqlca.sqlcode < 0)
    sql_err("pull_off_inv_bad");
  else
      return(SUCCESS);
 }


int count_good_2()
/* *************************************************************************
   Count remaining Good Inv
   ************************************************************************* */
 {

  EXEC SQL SELECT COUNT('A')
           INTO   :cnt_good_itm_2
           FROM   HHINV_LOAD_2;

  if (sqlca.sqlcode < 0)
    sql_err("count_good_2");
  else
      return(SUCCESS);
 }

/* ************************************************************************
   STAGE FOUR SUB ROUTINE
   ************************************************************************ */

int cre_attri_rows()
/* *************************************************************************
         To enable checks to be done on the attributes of the inventory
         items and to speed the expansion of domains. Inventory items
         with attributes are expanded to one line per attribute. These
         are then checked individually though any one error will stop
         the inventory item. The expansion is achieved via a cartesian
         product join to a simole table containing ten lines.
         NOTE: Inv items with no attributes will not move into LOAD_3
               at this stage. These invent types are processed by a second
               simpler route. They are identified by having a value
               in 'HHPOS1' in the table 'inv_item_type'. This assumes
               that the attributes appear in sequence from 1 to 10 in the
               husky hunter positions.  If this is not the case  then
               all items of the type may be duplicated or dropped. The
               impact elsewhere may be equally disasterous.
   ************************************************************************* */
 {

/* New statement below - See below for comments - D Turner 13-Dec-88 */

  switch (rmms_flag)
  {
  case 1 :
  case 3 :
  case 4 :
  EXEC SQL   INSERT INTO HHINV_LOAD_3
                ( REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  ATTRIBUTE,VALUE,ITY_SYS_FLAG )
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR1,
                  ltrim(HH.HHFLD1,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR1     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR2,
                  ltrim(HH.HHFLD2,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR2     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR3,
                  ltrim(HH.HHFLD3,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR3     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR4,
                  ltrim(HH.HHFLD4,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR4     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR5,
                  ltrim(HH.HHFLD5,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR5     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR6,
                  ltrim(HH.HHFLD6,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR6     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR7,
                  ltrim(HH.HHFLD7,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR7     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR8,
                  ltrim(HH.HHFLD8,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR8     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR9,
                  ltrim(HH.HHFLD9,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR9     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR10,
                  ltrim(HH.HHFLD10,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR10     IS NOT NULL /*orig*/
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR11,
                  ltrim(HH.HHFLD11,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR11     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR12,
                  ltrim(HH.HHFLD12,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR12     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR13,
                  ltrim(HH.HHFLD13,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR13     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR14,
                  ltrim(HH.HHFLD14,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR14     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR15,
                  ltrim(HH.HHFLD15,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR15     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR16,
                  ltrim(HH.HHFLD16,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR16     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR17,
                  ltrim(HH.HHFLD17,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR17     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR18,
                  ltrim(HH.HHFLD18,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR18     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR19,
                  ltrim(HH.HHFLD19,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR19     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR20,
                  ltrim(HH.HHFLD20,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR20     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR21,
                  ltrim(HH.HHFLD21,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR21     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR22,
                  ltrim(HH.HHFLD22,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR22     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR23,
                  ltrim(HH.HHFLD23,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR23     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR24,
                  ltrim(HH.HHFLD24,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR24     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR25,
                  ltrim(HH.HHFLD25,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR25     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR26,
                  ltrim(HH.HHFLD26,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR26     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR27,
                  ltrim(HH.HHFLD27,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR27     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR28,
                  ltrim(HH.HHFLD28,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR28     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR29,
                  ltrim(HH.HHFLD29,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR29     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR30,
                  ltrim(HH.HHFLD30,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR30     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR31,
                  ltrim(HH.HHFLD31,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR31     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR32,
                  ltrim(HH.HHFLD32,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR32     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR33,
                  ltrim(HH.HHFLD33,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR33     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR34,
                  ltrim(HH.HHFLD34,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR34     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR35,
                  ltrim(HH.HHFLD35,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR35     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR36,
                  ltrim(HH.HHFLD36,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR36     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR37,
                  ltrim(HH.HHFLD37,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR37     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR38,
                  ltrim(HH.HHFLD38,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR38     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR39,
                  ltrim(HH.HHFLD39,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR39     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR40,
                  ltrim(HH.HHFLD40,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR40     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR41,
                  ltrim(HH.HHFLD41,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR41     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR42,
                  ltrim(HH.HHFLD42,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR42     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR43,
                  ltrim(HH.HHFLD43,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR43     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR44,
                  ltrim(HH.HHFLD44,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR44     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR45,
                  ltrim(HH.HHFLD45,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR45     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR46,
                  ltrim(HH.HHFLD46,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR46     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR47,
                  ltrim(HH.HHFLD47,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR47     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR48,
                  ltrim(HH.HHFLD48,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR48     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR49,
                  ltrim(HH.HHFLD49,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR49     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR50,
                  ltrim(HH.HHFLD50,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR50     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR51,
                  ltrim(HH.HHFLD51,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR51     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR52,
                  ltrim(HH.HHFLD52,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR52     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR53,
                  ltrim(HH.HHFLD53,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR53     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR54,
                  ltrim(HH.HHFLD54,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR54     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR55,
                  ltrim(HH.HHFLD55,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR55     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR56,
                  ltrim(HH.HHFLD56,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR56     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR57,
                  ltrim(HH.HHFLD57,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR57     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR58,
                  ltrim(HH.HHFLD58,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR58     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR59,
                  ltrim(HH.HHFLD59,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR59     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR60,
                  ltrim(HH.HHFLD60,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR60     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR61,
                  ltrim(HH.HHFLD61,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR61     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR62,
                  ltrim(HH.HHFLD62,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR62     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR63,
                  ltrim(HH.HHFLD63,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR63     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR64,
                  ltrim(HH.HHFLD64,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR64     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR65,
                  ltrim(HH.HHFLD65,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR65     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR66,
                  ltrim(HH.HHFLD66,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR66     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR67,
                  ltrim(HH.HHFLD67,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR67     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR68,
                  ltrim(HH.HHFLD68,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR68     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR69,
                  ltrim(HH.HHFLD69,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR69     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR70,
                  ltrim(HH.HHFLD70,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR70     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR71,
                  ltrim(HH.HHFLD71,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR71     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR72,
                  ltrim(HH.HHFLD72,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR72     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR73,
                  ltrim(HH.HHFLD73,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR73     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR74,
                  ltrim(HH.HHFLD74,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR74     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR75,
                  ltrim(HH.HHFLD75,' '),HHINV_ITY_SYS_FLAG
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR75     IS NOT NULL;
      break;
   default:
   EXEC SQL   INSERT INTO HHINV_LOAD_3
                ( REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  ATTRIBUTE,VALUE )
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR1,
                  ltrim(HH.HHFLD1,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR1     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR2,
                  ltrim(HH.HHFLD2,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR2     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR3,
                  ltrim(HH.HHFLD3,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR3     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR4,
                  ltrim(HH.HHFLD4,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR4     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR5,
                  ltrim(HH.HHFLD5,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR5     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR6,
                  ltrim(HH.HHFLD6,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR6     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR7,
                  ltrim(HH.HHFLD7,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR7     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR8,
                  ltrim(HH.HHFLD8,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR8     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR9,
                  ltrim(HH.HHFLD9,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR9     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR10,
                  ltrim(HH.HHFLD10,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR10     IS NOT NULL /*orig*/
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR11,
                  ltrim(HH.HHFLD11,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR11     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR12,
                  ltrim(HH.HHFLD12,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR12     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR13,
                  ltrim(HH.HHFLD13,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR13     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR14,
                  ltrim(HH.HHFLD14,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR14     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR15,
                  ltrim(HH.HHFLD15,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR15     IS NOT NULL

   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR16,
                  ltrim(HH.HHFLD16,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR16     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR17,
                  ltrim(HH.HHFLD17,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR17     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR18,
                  ltrim(HH.HHFLD18,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR18     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR19,
                  ltrim(HH.HHFLD19,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR19     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR20,
                  ltrim(HH.HHFLD20,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR20     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR21,
                  ltrim(HH.HHFLD21,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR21     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR22,
                  ltrim(HH.HHFLD22,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR22     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR23,
                  ltrim(HH.HHFLD23,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR23     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR24,
                  ltrim(HH.HHFLD24,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR24     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR25,
                  ltrim(HH.HHFLD25,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR25     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR26,
                  ltrim(HH.HHFLD26,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR26     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR27,
                  ltrim(HH.HHFLD27,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR27     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR28,
                  ltrim(HH.HHFLD28,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR28     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR29,
                  ltrim(HH.HHFLD29,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR29     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR30,
                  ltrim(HH.HHFLD30,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR30     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR31,
                  ltrim(HH.HHFLD31,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR31     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR32,
                  ltrim(HH.HHFLD32,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR32     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR33,
                  ltrim(HH.HHFLD33,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR33     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR34,
                  ltrim(HH.HHFLD34,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR34     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR35,
                  ltrim(HH.HHFLD35,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR35     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR36,
                  ltrim(HH.HHFLD36,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR36     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR37,
                  ltrim(HH.HHFLD37,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR37     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR38,
                  ltrim(HH.HHFLD38,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR38     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR39,
                  ltrim(HH.HHFLD39,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR39     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR40,
                  ltrim(HH.HHFLD40,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR40     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR41,
                  ltrim(HH.HHFLD41,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR41     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR42,
                  ltrim(HH.HHFLD42,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR42     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR43,
                  ltrim(HH.HHFLD43,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR43     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR44,
                  ltrim(HH.HHFLD44,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR44     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR45,
                  ltrim(HH.HHFLD45,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR45     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR46,
                  ltrim(HH.HHFLD46,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR46     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR47,
                  ltrim(HH.HHFLD47,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR47     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR48,
                  ltrim(HH.HHFLD48,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR48     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR49,
                  ltrim(HH.HHFLD49,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR49     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR50,
                  ltrim(HH.HHFLD50,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR50     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR51,
                  ltrim(HH.HHFLD51,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR51     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR52,
                  ltrim(HH.HHFLD52,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR52     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR53,
                  ltrim(HH.HHFLD53,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR53     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR54,
                  ltrim(HH.HHFLD54,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR54     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR55,
                  ltrim(HH.HHFLD55,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR55     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR56,
                  ltrim(HH.HHFLD56,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR56     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR57,
                  ltrim(HH.HHFLD57,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR57     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR58,
                  ltrim(HH.HHFLD58,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR58     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR59,
                  ltrim(HH.HHFLD59,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR59     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR60,
                  ltrim(HH.HHFLD60,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR60     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR61,
                  ltrim(HH.HHFLD61,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR61     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR62,
                  ltrim(HH.HHFLD62,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR62     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR63,
                  ltrim(HH.HHFLD63,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR63     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR64,
                  ltrim(HH.HHFLD64,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR64     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR65,
                  ltrim(HH.HHFLD65,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR65     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR66,
                  ltrim(HH.HHFLD66,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR66     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR67,
                  ltrim(HH.HHFLD67,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR67     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR68,
                  ltrim(HH.HHFLD68,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR68     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR69,
                  ltrim(HH.HHFLD69,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR69     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR70,
                  ltrim(HH.HHFLD70,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR70     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR71,
                  ltrim(HH.HHFLD71,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR71     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR72,
                  ltrim(HH.HHFLD72,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR72     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR73,
                  ltrim(HH.HHFLD73,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR73     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR74,
                  ltrim(HH.HHFLD74,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR74     IS NOT NULL
   UNION
           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  HH.HHATTR75,
                  ltrim(HH.HHFLD75,' ')
           FROM   HHINV_LOAD_2 HH
           WHERE  ERROR_FLG IS NULL
           AND    HH.HHATTR75     IS NOT NULL ;
   }
/* Statement below replaced by the one above. Should result in
   less disk space use (about 20%). Implemented now but needs more
   testing, especially for memory problems on PC. Performance is
   about the same - D.Turner 13-Dec-88

  EXEC SQL INSERT INTO HHINV_LOAD_3
                ( REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  ATTRIBUTE,VALUE )

           SELECT REC_SEQ_NO,HE_ID,LINKCODE,SECTION_CODE,INV_CODE,ST_CHAIN,
                  END_CHAIN,PEO_INVENT_BY_ID,INVENT_DATE,X_SECT,
                  DECODE(RC.COUNT_ROW,1,HH.HHATTR1,2,HH.HHATTR2,
                                      3,HH.HHATTR3,4,HH.HHATTR4,
                                      5,HH.HHATTR5,6,HH.HHATTR6,
                                      7,HH.HHATTR7,8,HH.HHATTR8,
                                      9,HH.HHATTR9,10,HH.HHATTR10,NULL),
                  LTRIM(DECODE(RC.COUNT_ROW,1,HH.HHFLD1,2,HH.HHFLD2,
                                            3,HH.HHFLD3,4,HH.HHFLD4,
                                            5,HH.HHFLD5,6,HH.HHFLD6,
                                            7,HH.HHFLD7,8,HH.HHFLD8,
                                            9,HH.HHFLD9,10,HH.HHFLD10,
                                            NULL),' ')
           FROM   HHINV_LOAD_2 HH ,INV_ATTRI_ROW_CNT RC
           WHERE  ERROR_FLG IS NULL
           AND    DECODE(RC.COUNT_ROW,1,HH.HHATTR1,2,HH.HHATTR2,
                                      3,HH.HHATTR3,4,HH.HHATTR4,
                                      5,HH.HHATTR5,6,HH.HHATTR6,
                                      7,HH.HHATTR7,8,HH.HHATTR8,
                                      9,HH.HHATTR9,10,HH.HHATTR10,NULL)
                               IS NOT NULL;
*/

  if(sqlca.sqlcode < 0)
    sql_err("cre_attri_rows");
  else
    return(SUCCESS);
 }


int check_format()
/* *************************************************************************
   Check that the attributes that should contain numeric values do.
   ************************************************************************* */
 {
  /* Step changed to allow + and - characters - D Turner 05-Dec-88

     This step changed so that it throws out values which are meant to be
     numeric but contain embedded spaces. The only change was to RTRIM
     and LTRIM the value and to translate spaces to '$' - D.Turner 13-Dec-88 */

/* Step changed to validate for husky hunter format dates -- note assumes
   numeric check taken place -- changed to check date format as well*/

  switch (rmms_flag)
  {
  case 3 :
  case 4 :
  EXEC SQL UPDATE HHINV_LOAD_3 HH
           SET    ERROR_FLG = 'Y',
                  ERROR_MSG = 'Not a Numeric value.'
           WHERE  HH.VALUE IS NOT NULL
           AND    TRANSLATE(LTRIM(RTRIM(HH.VALUE)),
                            '$ +-1234567890.','$$') IS NOT NULL
           AND    EXISTS
         ( SELECT 'A'
           FROM   INV_TYPE_ATTRIBS ITA
           WHERE  HH.INV_CODE    = ITA.ITA_IIT_INV_CODE
           AND    'IIT_'||HH.ATTRIBUTE   = ITA.ITA_ATTRIB_NAME
           AND    HH.ITY_SYS_FLAG = ITA.ITA_ITY_SYS_FLAG
           AND    ITA.ITA_FORMAT = 'NUMBER');

      break;
   default:
   EXEC SQL UPDATE HHINV_LOAD_3 HH
           SET    ERROR_FLG = 'Y',
                  ERROR_MSG = 'Not a Numeric value.'
           WHERE  HH.VALUE IS NOT NULL
           AND    TRANSLATE(LTRIM(RTRIM(HH.VALUE)),
                            '$ +-1234567890.','$$') IS NOT NULL
           AND    EXISTS
         ( SELECT 'A'
           FROM   INV_TYPE_ATTRIBS ITA
           WHERE  HH.INV_CODE    = ITA.ITA_IIT_INV_CODE
           AND    'IIT_'||HH.ATTRIBUTE   = ITA.ITA_ATTRIB_NAME
           AND    ITA.ITA_FORMAT ='NUMBER');
   }

/*  EXEC SQL UPDATE HHINV_LOAD_3 HH
           SET    ERROR_FLG = 'Y',
                  ERROR_MSG = 'Not a valid date.'
           WHERE  HH.VALUE IS NOT NULL
           AND  NOT
           ( TO_NUMBER(SUBSTR(HH.VALUE,5,2))
             BETWEEN 0.5 AND
             DECODE(SUBSTR(HH.VALUE,3,2),'01',31,
              '02',DECODE(MOD(TO_NUMBER(SUBSTR(HH.VALUE,1,2)),4),0,29,28),
              '03',31, '04',30, '05',31, '06',30,'07',31,'08',31,
              '09',30, '10',31, '11',30, '12',31, 0.5 )
             AND to_number(SUBSTR(HH.VALUE,1,2)) > 01
             AND length(HH.VALUE) = 6
            )
           AND    EXISTS
         ( SELECT 'A'
           FROM   INV_TYPE_ATTRIBS ITA
           WHERE  HH.INV_CODE    = ITA.ITA_IIT_INV_CODE
           AND    HH.ERROR_FLG IS NULL
           AND    'IIT_'||HH.ATTRIBUTE   = ITA.ITA_ATTRIB_NAME
           AND    ITA.ITA_FORMAT = 'DATE' );    */

  if (sqlca.sqlcode < 0)
    sql_err("check_format");
  else
      return(SUCCESS);
 }
int min_max_mand()
/* *************************************************************************
   Check that the attributes are within max and min values
   ************************************************************************* */
 {

  switch (rmms_flag)
  {
  case 3 :
  case 4 :
  EXEC SQL  update hhinv_load_3 hh
        set    error_flg = 'Y',
               error_msg = decode(value,Null,
                                   'Mandatory Value is missing.',
                                   'Min or Max Values exceeded.')
        where  hh.error_flg is null
        and   (
               hh.inv_code  ,   'IIT_'||hh.attribute )
          in    (select
               ita.ita_iit_inv_code,
               ita.ita_attrib_name
               from   inv_type_attribs  ita
               where  ((ita_manditory_yn = 'Y'
                        and hh.value is null)
               or   decode(ita.ita_format,'NUMBER',to_number(hh.value),
                                      ita.ita_max + 1) > ita.ita_max
               or   decode(ita.ita_format,'NUMBER',to_number(hh.value),
                                      ita.ita_min  - 1) < ita.ita_min )
               and  ita.ita_ity_sys_flag = hh.ity_sys_flag);
       break;
    default:
    EXEC SQL  update hhinv_load_3 hh
        set    error_flg = 'Y',
               error_msg = decode(value,Null,
                                   'Mandatory Value is missing.',
                                   'Min or Max Values exceeded.')
        where  hh.error_flg is null
        and   (
               hh.inv_code  ,   'IIT_'||hh.attribute )
          in    (select
               ita.ita_iit_inv_code,
               ita.ita_attrib_name
               from   inv_type_attribs  ita
               where  (     ita_manditory_yn = 'Y'
                   and hh.value is null)
               or   decode(ita.ita_format,'NUMBER',to_number(hh.value),
                                      ita.ita_max + 1) > ita.ita_max
               or   decode(ita.ita_format,'NUMBER',to_number(hh.value),
                                      ita.ita_min  - 1) < ita.ita_min );
    }
/*   Statement below replaced by the one above so that mandatory
     values are checked for. - D Turner 13-Dec-88

     EXEC SQL  update hhinv_load_3 hh
        set    error_flg = 'Y',
               error_msg = decode(value,Null,
                                   'Mandatory Value is missing.',
                                   'Min or Max Values exceeded.')
        where  hh.error_flg is null
        and   (
               hh.inv_code  ,   'IIT_'||hh.attribute )
          in    (select
               ita.ita_iit_inv_code,
               ita.ita_attrib_name
               from   inv_type_attribs  ita
        where  ( to_number(hh.value) > ita.ita_max
        or     to_number(hh.value) < ita.ita_min
        ) and ita.ita_format = 'NUMBER');
*/

  if (sqlca.sqlcode < 0)
    sql_err("min_max_mand");
  else
      return(SUCCESS);
 }


int check_domain()
/* *************************************************************************
   Check that the inventory items of type 'Domain' contain values allowed
   within that domain.
   ************************************************************************* */
 {

  switch (rmms_flag)
  {
  case 3 :
  case 4 :
  EXEC SQL UPDATE HHINV_LOAD_3 HH
           SET    ERROR_FLG = 'Y',
                  ERROR_MSG = 'Not a Valid menu value.'
           WHERE  HH.VALUE IS NOT NULL
           AND    HH.ERROR_FLG IS NULL
           AND    EXISTS

         ( SELECT 'A'
           FROM   INV_TYPE_ATTRIBS ITA
           WHERE  HH.INV_CODE     = ITA.ITA_IIT_INV_CODE
           AND    'IIT_'||HH.ATTRIBUTE    = ITA.ITA_ATTRIB_NAME
           AND    ITA.ITA_ITY_SYS_FLAG = HH.ITY_SYS_FLAG
           AND    ( ITA.ITA_VALIDATE_YN = 'Y'
           AND    NOT EXISTS
                  ( SELECT 'A'
                    FROM   INV_ATTRI_DOMAINS IAD
                    WHERE  IAD.IAD_ITA_INV_CODE       = HH.INV_CODE
                    AND    IAD.IAD_ITA_ATTRIB_NAME     ='IIT_'||HH.ATTRIBUTE
                    AND    IAD.IAD_ITA_ITY_SYS_FLAG = HH.ITY_SYS_FLAG
                    AND    IAD.IAD_VALUE              = HH.VALUE ) ) );
     break;
  default:
  EXEC SQL UPDATE HHINV_LOAD_3 HH
           SET    ERROR_FLG = 'Y',
                  ERROR_MSG = 'Not a Valid menu value.'
           WHERE  HH.VALUE IS NOT NULL
           AND    HH.ERROR_FLG IS NULL
           AND    EXISTS

         ( SELECT 'A'
           FROM   INV_TYPE_ATTRIBS ITA
           WHERE  HH.INV_CODE     = ITA.ITA_IIT_INV_CODE
           AND    'IIT_'||HH.ATTRIBUTE    = ITA.ITA_ATTRIB_NAME
           AND    ( ITA.ITA_VALIDATE_YN = 'Y'
           AND    NOT EXISTS
                  ( SELECT 'A'
                    FROM   INV_ATTRI_DOMAINS IAD
                    WHERE  IAD.IAD_ITA_INV_CODE       = HH.INV_CODE
                    AND    IAD.IAD_ITA_ATTRIB_NAME     ='IIT_'||HH.ATTRIBUTE
                    AND    IAD.IAD_VALUE              = HH.VALUE ) ) );
   }

  if (sqlca.sqlcode < 0)
    sql_err("check_domain");
  else
      return(SUCCESS);
 }


int pull_into_err_3()
/* *************************************************************************
   Pull out of the mainstream file all the attributes flagged as in
   error.
   ************************************************************************* */
 {

  switch (rmms_flag)
  {
  case 1:
  case 3:
  case 4:
  EXEC SQL INSERT INTO HHINV_ITEM_ERR_3
                  (RUN_NUM,HE_ID,LINKCODE,SECTION_CODE,REC_SEQ_NO,INV_CODE,
                   PEO_INVENT_BY_ID,INVENT_DATE,ATTRIBUTE,VALUE,ERROR_MSG,
                   HHINV_ITY_SYS_FLAG)
           SELECT :run_num,HE_ID,HH.LINKCODE,HH.SECTION_CODE,HH.REC_SEQ_NO,
                  HH.INV_CODE,HH.PEO_INVENT_BY_ID,INVENT_DATE,
                  HH.ATTRIBUTE,HH.VALUE,
                  HH.ERROR_MSG,ITY_SYS_FLAG
           FROM   HHINV_LOAD_3 HH
           WHERE  HH.ERROR_FLG = 'Y';

      break;
   default:
   EXEC SQL INSERT INTO HHINV_ITEM_ERR_3
                  (RUN_NUM,HE_ID,LINKCODE,SECTION_CODE,REC_SEQ_NO,INV_CODE,
                   PEO_INVENT_BY_ID,INVENT_DATE,ATTRIBUTE,VALUE,ERROR_MSG)
           SELECT :run_num,HE_ID,HH.LINKCODE,HH.SECTION_CODE,HH.REC_SEQ_NO,
                  HH.INV_CODE,HH.PEO_INVENT_BY_ID,INVENT_DATE,
                  HH.ATTRIBUTE,HH.VALUE,
                  HH.ERROR_MSG
           FROM   HHINV_LOAD_3 HH
           WHERE  HH.ERROR_FLG = 'Y';
   }

  if (sqlca.sqlcode < 0)
    sql_err("pull_into_err_3");
  else
      return(SUCCESS);
 }


int pull_inv_due_attr()
/* *************************************************************************
   To keep the full record of each rejected inventory item, we need to pull out
   the rejected inventory items from LOAD_2 where the full record still exists.
   ************************************************************************* */
 {

  switch (rmms_flag)
  {
  case 1:
  case 3:
  case 4:
  EXEC SQL INSERT INTO HHINV_ITEM_ERR_2
                  (RUN_NUM,REC_SEQ_NO,SECT_HDR_SEQ_NO,HE_ID,SCL_CLASS,
                   LINKCODE,SECTION_CODE,INV_CODE,PEO_INVENT_BY_ID,
                   survey_length, hhinv_survey_direction,
                   sub_section_length, full_partial_ind,
                   INVENT_DATE,X_SECT,ST_CHAIN,END_CHAIN,ROAD_CHARACTERISTIC,
                   HHFLD1,HHATTR1,HHFLD2,HHATTR2,HHFLD3,HHATTR3,HHFLD4,
                   HHATTR4,HHFLD5,HHATTR5,HHFLD6,HHATTR6,HHFLD7,HHATTR7,
                   HHFLD8,HHATTR8,HHFLD9,HHATTR9,HHFLD10,HHATTR10,
                   HHFLD11,HHATTR11,HHFLD12,HHATTR12,HHFLD13,HHATTR13,
                   HHFLD14,HHATTR14,HHFLD15,HHATTR15,
                   HHFLD16,HHATTR16,HHFLD17,HHATTR17,HHFLD18,HHATTR18,
                   HHFLD19,HHATTR19,HHFLD20,HHATTR20,HHFLD21,HHATTR21,
                   HHFLD22,HHATTR22,HHFLD23,HHATTR23,HHFLD24,HHATTR24,
                   HHFLD25,HHATTR25,HHFLD26,HHATTR26,HHFLD27,HHATTR27,
                   HHFLD28,HHATTR28,HHFLD29,HHATTR29,HHFLD30,HHATTR30,
                   HHFLD31,HHATTR31,HHFLD32,HHATTR32,HHFLD33,HHATTR33,
                   HHFLD34,HHATTR34,HHFLD35,HHATTR35,HHFLD36,HHATTR36,
                   HHFLD37,HHATTR37,HHFLD38,HHATTR38,HHFLD39,HHATTR39,
                   HHFLD40,HHATTR40,HHFLD41,HHATTR41,HHFLD42,HHATTR42,
                   HHFLD43,HHATTR43,HHFLD44,HHATTR44,HHFLD45,HHATTR45,
                   HHFLD46,HHATTR46,HHFLD47,HHATTR47,HHFLD48,HHATTR48,
                   HHFLD49,HHATTR49,HHFLD50,HHATTR50,HHFLD51,HHATTR52,
                   HHFLD53,HHATTR53,HHFLD54,HHATTR54,HHFLD55,HHATTR55,
                   HHFLD56,HHATTR56,HHFLD57,HHATTR57,HHFLD58,HHATTR58,
                   HHFLD59,HHATTR59,HHFLD60,HHATTR60,HHFLD61,HHATTR61,
                   HHFLD62,HHATTR62,HHFLD63,HHATTR63,HHFLD64,HHATTR64,
                   HHFLD65,HHATTR65,HHFLD66,HHATTR66,HHFLD67,HHATTR67,
                   HHFLD68,HHATTR68,HHFLD69,HHATTR69,HHFLD70,HHATTR70,
                   HHFLD71,HHATTR71,HHFLD72,HHATTR72,HHFLD73,HHATTR73,
                   HHFLD74,HHATTR74,HHFLD75,HHATTR75,
                   HHINV_ITY_SYS_FLAG)
           SELECT  :run_num,REC_SEQ_NO,SECT_HDR_SEQ_NO,HE_ID,SCL_CLASS,
                   LINKCODE,SECTION_CODE,INV_CODE,PEO_INVENT_BY_ID,
                   survey_length, hhinv_survey_direction,
                   sub_section_length, full_partial_ind,
                   INVENT_DATE,X_SECT,ST_CHAIN,END_CHAIN,ROAD_CHARACTERISTIC,
                   HHFLD1,HHATTR1,HHFLD2,HHATTR2,HHFLD3,HHATTR3,HHFLD4,
                   HHATTR4,HHFLD5,HHATTR5,HHFLD6,HHATTR6,HHFLD7,HHATTR7,
                   HHFLD8,HHATTR8,HHFLD9,HHATTR9,HHFLD10,HHATTR10,
                   HHFLD11,HHATTR11,HHFLD12,HHATTR12,HHFLD13,HHATTR13,
                   HHFLD14,HHATTR14,HHFLD15,HHATTR15,
                   HHFLD16,HHATTR16,HHFLD17,HHATTR17,HHFLD18,HHATTR18,
                   HHFLD19,HHATTR19,HHFLD20,HHATTR20,HHFLD21,HHATTR21,
                   HHFLD22,HHATTR22,HHFLD23,HHATTR23,HHFLD24,HHATTR24,
                   HHFLD25,HHATTR25,HHFLD26,HHATTR26,HHFLD27,HHATTR27,
                   HHFLD28,HHATTR28,HHFLD29,HHATTR29,HHFLD30,HHATTR30,
                   HHFLD31,HHATTR31,HHFLD32,HHATTR32,HHFLD33,HHATTR33,
                   HHFLD34,HHATTR34,HHFLD35,HHATTR35,HHFLD36,HHATTR36,
                   HHFLD37,HHATTR37,HHFLD38,HHATTR38,HHFLD39,HHATTR39,
                   HHFLD40,HHATTR40,HHFLD41,HHATTR41,HHFLD42,HHATTR42,
                   HHFLD43,HHATTR43,HHFLD44,HHATTR44,HHFLD45,HHATTR45,
                   HHFLD46,HHATTR46,HHFLD47,HHATTR47,HHFLD48,HHATTR48,
                   HHFLD49,HHATTR49,HHFLD50,HHATTR50,HHFLD51,HHATTR52,
                   HHFLD53,HHATTR53,HHFLD54,HHATTR54,HHFLD55,HHATTR55,
                   HHFLD56,HHATTR56,HHFLD57,HHATTR57,HHFLD58,HHATTR58,
                   HHFLD59,HHATTR59,HHFLD60,HHATTR60,HHFLD61,HHATTR61,
                   HHFLD62,HHATTR62,HHFLD63,HHATTR63,HHFLD64,HHATTR64,
                   HHFLD65,HHATTR65,HHFLD66,HHATTR66,HHFLD67,HHATTR67,
                   HHFLD68,HHATTR68,HHFLD69,HHATTR69,HHFLD70,HHATTR70,
                   HHFLD71,HHATTR71,HHFLD72,HHATTR72,HHFLD73,HHATTR73,
                   HHFLD74,HHATTR74,HHFLD75,HHATTR75,
                   HHINV_ITY_SYS_FLAG
           FROM    HHINV_LOAD_2 HHL2
           WHERE   (HHL2.REC_SEQ_NO)
           IN
         ( SELECT  HHL3.REC_SEQ_NO
           FROM    HHINV_LOAD_3 HHL3
           WHERE   HHL3.ERROR_FLG = 'Y'
           AND     HHL3.ITY_SYS_FLAG = HHL2.HHINV_ITY_SYS_FLAG );
     break;
  default:
  EXEC SQL INSERT INTO HHINV_ITEM_ERR_2
                  (RUN_NUM,REC_SEQ_NO,SECT_HDR_SEQ_NO,HE_ID,SCL_CLASS,
                   LINKCODE,SECTION_CODE,INV_CODE,PEO_INVENT_BY_ID,
                   survey_length, hhinv_survey_direction,
                   sub_section_length, full_partial_ind,
                   INVENT_DATE,X_SECT,ST_CHAIN,END_CHAIN,ROAD_CHARACTERISTIC,
                   HHFLD1,HHATTR1,HHFLD2,HHATTR2,HHFLD3,HHATTR3,HHFLD4,
                   HHATTR4,HHFLD5,HHATTR5,HHFLD6,HHATTR6,HHFLD7,HHATTR7,
                   HHFLD8,HHATTR8,HHFLD9,HHATTR9,HHFLD10,HHATTR10,
                   HHFLD11,HHATTR11,HHFLD12,HHATTR12,HHFLD13,HHATTR13,
                   HHFLD14,HHATTR14,HHFLD15,HHATTR15,
                   HHFLD16,HHATTR16,HHFLD17,HHATTR17,HHFLD18,HHATTR18,
                   HHFLD19,HHATTR19,HHFLD20,HHATTR20,HHFLD21,HHATTR21,
                   HHFLD22,HHATTR22,HHFLD23,HHATTR23,HHFLD24,HHATTR24,
                   HHFLD25,HHATTR25,HHFLD26,HHATTR26,HHFLD27,HHATTR27,
                   HHFLD28,HHATTR28,HHFLD29,HHATTR29,HHFLD30,HHATTR30,
                   HHFLD31,HHATTR31,HHFLD32,HHATTR32,HHFLD33,HHATTR33,
                   HHFLD34,HHATTR34,HHFLD35,HHATTR35,HHFLD36,HHATTR36,
                   HHFLD37,HHATTR37,HHFLD38,HHATTR38,HHFLD39,HHATTR39,
                   HHFLD40,HHATTR40,HHFLD41,HHATTR41,HHFLD42,HHATTR42,
                   HHFLD43,HHATTR43,HHFLD44,HHATTR44,HHFLD45,HHATTR45,
                   HHFLD46,HHATTR46,HHFLD47,HHATTR47,HHFLD48,HHATTR48,
                   HHFLD49,HHATTR49,HHFLD50,HHATTR50,HHFLD51,HHATTR52,
                   HHFLD53,HHATTR53,HHFLD54,HHATTR54,HHFLD55,HHATTR55,
                   HHFLD56,HHATTR56,HHFLD57,HHATTR57,HHFLD58,HHATTR58,
                   HHFLD59,HHATTR59,HHFLD60,HHATTR60,HHFLD61,HHATTR61,
                   HHFLD62,HHATTR62,HHFLD63,HHATTR63,HHFLD64,HHATTR64,
                   HHFLD65,HHATTR65,HHFLD66,HHATTR66,HHFLD67,HHATTR67,
                   HHFLD68,HHATTR68,HHFLD69,HHATTR69,HHFLD70,HHATTR70,
                   HHFLD71,HHATTR71,HHFLD72,HHATTR72,HHFLD73,HHATTR73,
                   HHFLD74,HHATTR74,HHFLD75,HHATTR75)
           SELECT  :run_num,REC_SEQ_NO,SECT_HDR_SEQ_NO,HE_ID,SCL_CLASS,
                   LINKCODE,SECTION_CODE,INV_CODE,PEO_INVENT_BY_ID,
                   survey_length, hhinv_survey_direction,
                   sub_section_length, full_partial_ind,
                   INVENT_DATE,X_SECT,ST_CHAIN,END_CHAIN,ROAD_CHARACTERISTIC,
                   HHFLD1,HHATTR1,HHFLD2,HHATTR2,HHFLD3,HHATTR3,HHFLD4,
                   HHATTR4,HHFLD5,HHATTR5,HHFLD6,HHATTR6,HHFLD7,HHATTR7,
                   HHFLD8,HHATTR8,HHFLD9,HHATTR9,HHFLD10,HHATTR10,
                   HHFLD11,HHATTR11,HHFLD12,HHATTR12,HHFLD13,HHATTR13,
                   HHFLD14,HHATTR14,HHFLD15,HHATTR15,
                   HHFLD16,HHATTR16,HHFLD17,HHATTR17,HHFLD18,HHATTR18,
                   HHFLD19,HHATTR19,HHFLD20,HHATTR20,HHFLD21,HHATTR21,
                   HHFLD22,HHATTR22,HHFLD23,HHATTR23,HHFLD24,HHATTR24,
                   HHFLD25,HHATTR25,HHFLD26,HHATTR26,HHFLD27,HHATTR27,
                   HHFLD28,HHATTR28,HHFLD29,HHATTR29,HHFLD30,HHATTR30,
                   HHFLD31,HHATTR31,HHFLD32,HHATTR32,HHFLD33,HHATTR33,
                   HHFLD34,HHATTR34,HHFLD35,HHATTR35,HHFLD36,HHATTR36,
                   HHFLD37,HHATTR37,HHFLD38,HHATTR38,HHFLD39,HHATTR39,
                   HHFLD40,HHATTR40,HHFLD41,HHATTR41,HHFLD42,HHATTR42,
                   HHFLD43,HHATTR43,HHFLD44,HHATTR44,HHFLD45,HHATTR45,
                   HHFLD46,HHATTR46,HHFLD47,HHATTR47,HHFLD48,HHATTR48,
                   HHFLD49,HHATTR49,HHFLD50,HHATTR50,HHFLD51,HHATTR52,
                   HHFLD53,HHATTR53,HHFLD54,HHATTR54,HHFLD55,HHATTR55,
                   HHFLD56,HHATTR56,HHFLD57,HHATTR57,HHFLD58,HHATTR58,
                   HHFLD59,HHATTR59,HHFLD60,HHATTR60,HHFLD61,HHATTR61,
                   HHFLD62,HHATTR62,HHFLD63,HHATTR63,HHFLD64,HHATTR64,
                   HHFLD65,HHATTR65,HHFLD66,HHATTR66,HHFLD67,HHATTR67,
                   HHFLD68,HHATTR68,HHFLD69,HHATTR69,HHFLD70,HHATTR70,
                   HHFLD71,HHATTR71,HHFLD72,HHATTR72,HHFLD73,HHATTR73,
                   HHFLD74,HHATTR74,HHFLD75,HHATTR75
           FROM    HHINV_LOAD_2 HHL2
           WHERE   (HHL2.REC_SEQ_NO)
           IN
         ( SELECT  HHL3.REC_SEQ_NO
           FROM    HHINV_LOAD_3 HHL3
           WHERE   HHL3.ERROR_FLG = 'Y' );
  }

  if (sqlca.sqlcode < 0)
    sql_err("pull_inv_due_attr");
  else
      return(SUCCESS);
 }


upd_x_err_2()
 {

  EXEC SQL UPDATE HHINV_SECT_LOG HHSl
           SET    SUCCESS_STAT = 2,
                  ERROR_LEVEL  = 'ITEM',
                  ERROR_MSG = 'Invent Items contain errors'
           WHERE  HHSl.REC_SEQ_NO
           IN
         ( SELECT HHI2.SECT_HDR_SEQ_NO
           FROM   HHINV_ITEM_ERR_2 HHI2
           WHERE  HHI2.RUN_NUM = :run_num )

           AND    LST_RUN_NUM = :run_num
           AND    ERROR_MSG IS NULL;

  if (sqlca.sqlcode < 0)
    sql_err("upd_x_err_2");
  else
      return(SUCCESS);
 }

/* **************************************************************************
     STAGE FIVE SUB ROUTINE
   ************************************************************************** */
int values_to_attri()
 {
  EXEC SQL BEGIN DECLARE SECTION;
    int   errors=0;
    short ierrors;
  EXEC SQL END DECLARE SECTION;

  EXEC SQL EXECUTE
    DECLARE
      lv_error PLS_INTEGER;
    BEGIN
      mai2110c.set_attrib_values(lv_error);
      :errors:ierrors := lv_error;
    END;
  END-EXEC;
  /*---------------------------*/
  /* Move Sections With Errors */
  /* Into The Error Tables     */
  /*---------------------------*/
  if(errors)
    {
    ct_3_nw_err();
    pull_into_err_3();
    pull_inv_due_attr();
    pull_off_inv_bad();
    upd_x_err_2();
    }
  if(sqlca.sqlcode < 0)
    sql_err("values_to_attri");
  else
    return(SUCCESS);
 }

int load_into_invent()
{
  EXEC SQL BEGIN DECLARE SECTION;
    int   errors_occured=0,records_created=0;
    short ierrors_occured,irecords_created;
  EXEC SQL END DECLARE SECTION;
  /*---------------------------*/
  /* Call PLSQL Procedure To   */
  /* Create The Assets In NM3  */
  /*---------------------------*/
  EXEC SQL EXECUTE
    DECLARE
      lv_error PLS_INTEGER;
      lv_count PLS_INTEGER;
    BEGIN
      mai2110c.ins_assets(:run_num
                         ,lv_count
                         ,lv_error);
      :records_created:irecords_created := lv_count;
      :errors_occured:ierrors_occured  := lv_error;
    END;
  END-EXEC;
  if(sqlca.sqlcode < 0)
    sql_err("load_into_invent 1");

  C_cards += records_created;
  /*---------------------------*/
  /* Move Sections With Errors */
  /* Into The Error Tables     */
  /*---------------------------*/
  if(errors_occured)
    {
    ct_3_nw_err();
    pull_into_err_3();
    pull_inv_due_attr();
    upd_x_err_2();
    }
  if(sqlca.sqlcode < 0)
    sql_err("load_into_invent 2");
  else
    return(SUCCESS);
} /* load_into_invent */

int cpy_invent_no_attri()
/* *************************************************************************
      The statement which moves data into LOAD_3 only processes those
      inventory items which have extra attributes. Those which do not
      are left in the LOAD_2 table. They are moved into the main database
      tables here. They do not need any clever processing.
   ************************************************************************* */
{

  switch (rmms_flag)
    {
    case 1 :
    case 3 :
    case 4 :
             EXEC SQL
             INSERT
               INTO inv_items_all
                   (iit_item_id,iit_rse_he_id
                   ,iit_st_chain
                   ,iit_end_chain
                   ,iit_x_sect,iit_ity_inv_code,iit_peo_invent_by_id
                   ,iit_cre_date,iit_ity_sys_flag,iit_coord_flag
                   ,iit_created_date, iit_last_updated_date
                   ,iit_primary_key)
             SELECT REC_SEQ_NO,HE_ID
                   ,round(ST_CHAIN,3)  -- ecdm 691564
                   ,round(END_CHAIN,3)  -- ecdm 691564
                   ,X_SECT,INV_CODE,PEO_INVENT_BY_ID
                   ,INVENT_DATE,HHINV_ITY_SYS_FLAG,'I'
                   ,to_date(:full_date,'DD-MON-RR:HH24:MI:SS')
                   ,to_date(:full_date,'DD-MON-RR:HH24:MI:SS')
                   ,REC_SEQ_NO
               FROM HHINV_LOAD_2 HH
              WHERE ERROR_FLG IS NULL
                AND INV_CODE IN(SELECT ITY_INV_CODE
                                  FROM INV_ITEM_TYPES II
                                 WHERE II.ITY_HHPOS1 IS NULL
                                   AND II.ITY_SYS_FLAG = HH.HHINV_ITY_SYS_FLAG)
                   ;
             break;
    default:
             EXEC SQL
             INSERT
               INTO INV_ITEMS
                   (IIT_ITEM_ID
                   ,IIT_RSE_HE_ID
                   ,IIT_ST_CHAIN
                   ,IIT_END_CHAIN
                   ,IIT_X_SECT
                   ,IIT_ITY_INV_CODE
                   ,IIT_PEO_INVENT_BY_ID
                   ,IIT_CRE_DATE
                   ,iit_created_date
                   ,iit_last_updated_date
                   ,iit_primary_key)
             SELECT REC_SEQ_NO,HE_ID
                   ,round(ST_CHAIN,3) -- ecdm 691564
                   ,round(END_CHAIN,3) -- ecdm 691564
                   ,X_SECT
                   ,INV_CODE
                   ,PEO_INVENT_BY_ID
                   ,INVENT_DATE
                   ,to_date(:full_date,'DD-MON-RR:HH24:MI:SS')
                   ,to_date(:full_date,'DD-MON-RR:HH24:MI:SS')
                   ,REC_SEQ_NO
               FROM HHINV_LOAD_2
              WHERE ERROR_FLG IS NULL
                AND INV_CODE IN(SELECT ITY_INV_CODE
                                  FROM INV_ITEM_TYPES
                                 WHERE ITY_HHPOS1 IS NULL)
                  ;
    }

  if(sqlca.sqlcode < 0)
    {
    buf_len = sizeof (sqlerrmsg);
    sqlglm(sqlerrmsg, &buf_len, &msg_len);
    fprintf(fi,"Error: Occured In cpy_invent_no_attri\n");
    fprintf(fi,"%.*s\n\n", msg_len, sqlerrmsg);
    fflush(fi);
    sql_err("cpy_invent_no_attri");
    return(FAIL);
    }

  return(SUCCESS);

}

/* *************************************************************************
   FINISH !!!!!!!!!!!!!!!!!!!!!!!!!!!!!
   ************************************************************************* */
int count_sect_err()
/* *************************************************************************
   Count Sections
   ************************************************************************* */
 {

  EXEC SQL SELECT COUNT('A'),COUNT(ERROR_MSG)
           INTO   :new_sect, :newsec_err
           FROM   HHINV_SECT_LOG
           WHERE  LST_RUN_NUM = :run_num;

  if (sqlca.sqlcode < 0)
    sql_err("count_sect_err");
  else
      return(SUCCESS);
 }


int re_set_sect()
/* *************************************************************************
       If the whole run completes successfully, then update the section
       logs which have not had any errors flagged against them to say
       that them have been completed.
   ************************************************************************* */
 {

  EXEC SQL UPDATE HHINV_SECT_LOG HHSl
           SET    RE_SUB_FLG = 'C'
           WHERE  LST_RUN_NUM = :run_num
           AND    ERROR_MSG IS NULL;

  if (sqlca.sqlcode < 0)
    sql_err("re_set_sect");
  else
      return(SUCCESS);
 }

int fin_upd_run_log()
/* *************************************************************************
    Called to record that the run has  completed successfully.
    Stores away some useful details of the runs results
   ************************************************************************* */
 {

 char temp[10];

  EXEC SQL UPDATE HHINV_RUN_LOG
           SET    RUN_STAT = :cur_run_stat,
                  RUN_STAGE = 'OK',
                  SECTION_ERR_CNT = :newsec_err,
                  SECTION_CNT = :new_sect,
                  ERROR_MSG = DECODE (0,(NVL(:newerr_1,0) +
                                         NVL(:newerr_2,0) +
                                         NVL(:newerr_3,0)),
                                         'Finished: No Errors',
                                         'Finished: With Errors'),
                 ITEM_CNT = NVL(:tot_err,0) +
                            NVL(:tot_run,0),
                 ITEM_ERR_CNT = NVL(:newerr_1,0) +
                                NVL(:newerr_2,0) +
                                NVL(:newerr_3,0)
                 WHERE  RUN_NUM = :run_num;
  if (sqlca.sqlcode < 0)
    sql_err("fin_upd_run_log");

   fprintf(fi,"\nINFO: Total Number of A cards processed :");
   fprintf(fi," %d BPR-0007\n",A_cards);
   printf("\nINFO: Total Number of A cards processed :");
   printf(" %d BPR-0007\n",A_cards);
   i_toa(A_cards,temp);
   strcpy(pipe_msg,"INFO: Total Number of A cards processed : ");
   strcat(pipe_msg,temp);
   strcat(pipe_msg," BPR-0007");
   write_pipe(fi,pipe_msg);

   fprintf(fi,"\nINFO: Total Number of B cards processed :");
   fprintf(fi," %d BPR-0611\n",B_cards);
   printf("\nINFO: Total Number of B cards processed :");
   printf(" %d BPR-0611\n",B_cards);
   i_toa(B_cards,temp);
   strcpy(pipe_msg,"INFO: Total Number of B cards processed : ");
   strcat(pipe_msg,temp);
   strcat(pipe_msg," BPR-0611");
   write_pipe(fi,pipe_msg);

   fprintf(fi,"\nINFO: Total Number of C cards processed :");
   fprintf(fi," %d BPR-0612\n",C_cards);
   printf("\nINFO: Total Number of C cards processed :");
   printf(" %d BPR-0612\n",C_cards);
   i_toa(C_cards,temp);
   strcpy(pipe_msg,"INFO: Total Number of C cards processed : ");
   strcat(pipe_msg,temp);
   strcat(pipe_msg," BPR-0612");
   write_pipe(fi,pipe_msg);

   fprintf(fi,"\nINFO: Total Number of Z cards processed :");
   fprintf(fi," %d BPR-0613\n",Z_cards);
   printf("\nINFO: Total Number of Z cards processed :");
   printf(" %d BPR-0613\n",Z_cards);
   i_toa(Z_cards,temp);
   strcpy(pipe_msg,"INFO: Total Number of Z cards processed : ");
   strcat(pipe_msg,temp);
   strcat(pipe_msg," BPR-0613");
   write_pipe(fi,pipe_msg);

   if ( (newsec_err > 0) || (newerr_1 > 0) || (newerr_2 >0) || (newerr_3 > 0) )
      {
       fprintf(fi,"\nINFO: Errors occurred during load. Correct and re-submit");
       fprintf(fi," BPR-0614\n");
       printf("\nINFO: Errors occurred during load. Correct and re-submit");
       printf(" BPR-0614\n");
       strcpy(pipe_msg,"INFO: Errors occurred during load. Correct and ");
       strcat(pipe_msg,"re-submit BPR-0614");
       write_pipe(fi,pipe_msg);
      }
   else
      {
       fprintf(fi,"\nINFO: No errors were encountered.           BPR-0615\n");
       printf("\nINFO: No errors were encountered.           BPR-0615\n");
       strcpy(pipe_msg,"INFO: No errors were encountered.           BPR-0615");
       write_pipe(fi,pipe_msg);
      }

  return(SUCCESS);
 }


/* ************************************************************************
   ************************************************************************
   LAST_FIN_OK and LAST_NOT_START "SUB" FUNCTIONS
   ************************************************************************
   ************************************************************************ */


int cleanup_last_run()
 {
  if ( ( status = check_tab() ) != SUCCESS )
   {
    return(status);
   }
  if ( ( status = dl_lo_2() ) != SUCCESS )
   {
    return(status);
   }

  if ( ( status = check_tab() ) != SUCCESS )
   {
    return(status);
   }

  if ( ( status = dl_lo_3() ) != SUCCESS )
   {
    return(status);
   }




  return(status);

 }


int get_last_itemcode()
/* **********************************************************************
   Get max itemcode used so far used to find itemcode range of last section
   ********************************************************************** */
 {
  EXEC SQL SELECT ne_id_seq.nextval
            into :icode
            FROM dual;

  if (sqlca.sqlcode < 0)
    sql_err("get_last_itemcode");
  else
      return(SUCCESS);
 }

int upd_x_range()
/* ************************************************************************
   Calculate The Inv Item value range for each section and identify as
   being in run
   ************************************************************************ */
 {
  EXEC SQL UPDATE HHINV_SECT_LOG HHSl
           SET    (MAX_SEQ_NO,
                   LST_RUN_NUM,
                   FST_RUN_NUM)
           =
         ( SELECT  NVL(MIN(HHLB.REC_SEQ_NO),:icode) ,
                   :run_num ,
                   :run_num
           FROM    HHINV_SECT_LOG HHLB
           WHERE   HHLB.REC_SEQ_NO > HHSl.REC_SEQ_NO
           AND     FST_RUN_NUM = 0 )

           WHERE   FST_RUN_NUM = 0;

  if (sqlca.sqlcode < 0)
    sql_err("upd_x_range");
  else
      return(SUCCESS);
 }

/* ************************************************************************
   ************************************************************************
   CLEANUP "SUB" FUNCTIONS
   ************************************************************************
   ************************************************************************ */

int check_tab()
/* *************************************************************************
   Looks in the catalog table to see if table already exists before
   tries to rebuild it.
   ************************************************************************* */
 {
  EXEC SQL SELECT 'EXISTS'
           INTO    :tab_exist_msg
           FROM    user_objects
           WHERE  object_name = :tab_name;

  if (sqlca.sqlcode < 0)
    sql_err("check_tab");
  else
      return(SUCCESS);
 }

/* *****************************************************************
   ********* TABLE Create, Drop and Rename statements ****************
   *******************************************************************

   ********************************************************************
    Rename LOAD_1 for two reasons. 1) Means can hold source data against
    a disater in processing. 2) Bug in RPT prevents us dropping table
    at end of run.
   ********************************************************************* */
int dl_lo_2()
 {
   EXEC SQL truncate table hhinv_load_2;

  if (sqlca.sqlcode < 0)
    sql_err("dl_lo_2");
  else
      return(SUCCESS);
 }

int dl_lo_3()
  {
  exec sql whenever sqlerror continue;
  exec sql whenever sqlwarning continue;

  EXEC SQL DROP TABLE HHINV_LOAD_3;
  if(sqlca.sqlcode < 0)
    {
    sql_err("dl_lo_3_drop");
    }
  switch (rmms_flag)
  {
  case 3 :
  case 1 :
  case 4 :
  EXEC SQL CREATE TABLE HHINV_LOAD_3
                    (REC_SEQ_NO            NUMBER(8)     NOT NULL,
                     HE_ID                 NUMBER(8,0)   NOT NULL,
                     LINKCODE              VARCHAR2(10)  NOT NULL,
                     SECTION_CODE          VARCHAR2(5)   NOT NULL,
                     INV_CODE              VARCHAR2(4)   NOT NULL,
                     ATTRIBUTE             VARCHAR2(32)  NOT NULL,
                     ST_CHAIN              NUMBER        NOT NULL,
                     END_CHAIN             NUMBER        NOT NULL,
                     PEO_INVENT_BY_ID      NUMBER(8,0),
                     INVENT_DATE           DATE,
                     X_SECT                VARCHAR2(4),
                     VALUE                 VARCHAR2(500),
                     ERROR_MSG             VARCHAR2(4000),
                     ERROR_FLG             VARCHAR2(1),
                     LENGTH                NUMBER(6),
                     GAP                   NUMBER(6,2),
                     WIDTH                 NUMBER(6,2),
                     HEIGHT                NUMBER(6,2),
                     HEIGHT_2              NUMBER(6,2),
                     DISTANCE              NUMBER(7,2),
                     ANGLE                 NUMBER(6,2),
                     NO_OF_UNITS           NUMBER(3),
                     POWER                 NUMBER(6),
                     TYPE                  VARCHAR2(2),
                     CLASS                 VARCHAR2(2),
                     MATERIAL              VARCHAR2(2),
                     COLOUR                VARCHAR2(2),
                     OWNER                 VARCHAR2(4),
                     METHOD                VARCHAR2(2),
                     OPTIONS               VARCHAR2(2),
                     DESCRIPTION           VARCHAR2(40),
                     ID_CODE               VARCHAR2(8),
                     DIAGRAM               VARCHAR2(6),
                     PHOTO                 VARCHAR2(6),
                     NOTE                  VARCHAR2(40),
                     INSTAL_DATE           DATE,
                     ITEMCODE              VARCHAR2(8),
                     XTRA_CHAR_1           VARCHAR2(20),
                     XTRA_DATE_1           DATE,
                     XTRA_DOMAIN_1         VARCHAR2(2),
                     XTRA_NUMBER_1         NUMBER(10,2),
                     PRIMARY_KEY           VARCHAR2(50),
                     FOREIGN_KEY           VARCHAR2(50),
                     DESCR                 VARCHAR2(40),  /* Added For NM3 */
                     LOCATED_BY            NUMBER(9),     /* Added For NM3 */
                     POSITION              NUMBER,        /* Added For NM3 */
                     X_COORD               NUMBER,        /* Added For NM3 */
                     Y_COORD               NUMBER,        /* Added For NM3 */
                     COORD_FLAG            VARCHAR2(1),   /* Added For NM3 */
                     INV_OWNERSHIP         VARCHAR2(4),   /* Added For NM3 */
                     LCO_LAMP_CONFIG_ID    NUMBER(3),     /* Added For NM3 */
                     OUN_ORG_ID_ELEC_BOARD NUMBER(8),     /* Added For NM3 */
                     PROV_FLAG             VARCHAR2(1),   /* Added For NM3 */
                     REV_BY                VARCHAR2(20),  /* Added For NM3 */
                     REV_DATE              DATE,          /* Added For NM3 */
                     OFFSET                NUMBER,        /* Added For NM3 */
                     X                     NUMBER,        /* Added For NM3 */
                     Y                     NUMBER,        /* Added For NM3 */
                     Z                     NUMBER,        /* Added For NM3 */
                     NUM_ATTRIB16          NUMBER,
                     NUM_ATTRIB17          NUMBER,
                     NUM_ATTRIB18          NUMBER,
                     NUM_ATTRIB19          NUMBER,
                     NUM_ATTRIB20          NUMBER,
                     NUM_ATTRIB21          NUMBER,
                     NUM_ATTRIB22          NUMBER,
                     NUM_ATTRIB23          NUMBER,
                     NUM_ATTRIB24          NUMBER,
                     NUM_ATTRIB25          NUMBER,
                     CHR_ATTRIB26          VARCHAR2(50),
                     CHR_ATTRIB27          VARCHAR2(50),
                     CHR_ATTRIB28          VARCHAR2(50),
                     CHR_ATTRIB29          VARCHAR2(50),
                     CHR_ATTRIB30          VARCHAR2(50),
                     CHR_ATTRIB31          VARCHAR2(50),
                     CHR_ATTRIB32          VARCHAR2(50),
                     CHR_ATTRIB33          VARCHAR2(50),
                     CHR_ATTRIB34          VARCHAR2(50),
                     CHR_ATTRIB35          VARCHAR2(50),
                     CHR_ATTRIB36          VARCHAR2(50),
                     CHR_ATTRIB37          VARCHAR2(50),
                     CHR_ATTRIB38          VARCHAR2(50),
                     CHR_ATTRIB39          VARCHAR2(50),
                     CHR_ATTRIB40          VARCHAR2(50),
                     CHR_ATTRIB41          VARCHAR2(50),
                     CHR_ATTRIB42          VARCHAR2(50),
                     CHR_ATTRIB43          VARCHAR2(50),
                     CHR_ATTRIB44          VARCHAR2(50),
                     CHR_ATTRIB45          VARCHAR2(50),
                     CHR_ATTRIB46          VARCHAR2(50),
                     CHR_ATTRIB47          VARCHAR2(50),
                     CHR_ATTRIB48          VARCHAR2(50),
                     CHR_ATTRIB49          VARCHAR2(50),
                     CHR_ATTRIB50          VARCHAR2(50),
                     CHR_ATTRIB51          VARCHAR2(50),
                     CHR_ATTRIB52          VARCHAR2(50),
                     CHR_ATTRIB53          VARCHAR2(50),
                     CHR_ATTRIB54          VARCHAR2(50),
                     CHR_ATTRIB55          VARCHAR2(50),
                     CHR_ATTRIB56          VARCHAR2(200),
                     CHR_ATTRIB57          VARCHAR2(200),
                     CHR_ATTRIB58          VARCHAR2(200),
                     CHR_ATTRIB59          VARCHAR2(200),
                     CHR_ATTRIB60          VARCHAR2(200),
                     CHR_ATTRIB61          VARCHAR2(200),
                     CHR_ATTRIB62          VARCHAR2(200),
                     CHR_ATTRIB63          VARCHAR2(200),
                     CHR_ATTRIB64          VARCHAR2(200),
                     CHR_ATTRIB65          VARCHAR2(200),
                     CHR_ATTRIB66          VARCHAR2(500),
                     CHR_ATTRIB67          VARCHAR2(500),
                     CHR_ATTRIB68          VARCHAR2(500),
                     CHR_ATTRIB69          VARCHAR2(500),
                     CHR_ATTRIB70          VARCHAR2(500),
                     CHR_ATTRIB71          VARCHAR2(500),
                     CHR_ATTRIB72          VARCHAR2(500),
                     CHR_ATTRIB73          VARCHAR2(500),
                     CHR_ATTRIB74          VARCHAR2(500),
                     CHR_ATTRIB75          VARCHAR2(500),
                     NUM_ATTRIB76          NUMBER,
                     NUM_ATTRIB77          NUMBER,
                     NUM_ATTRIB78          NUMBER,
                     NUM_ATTRIB79          NUMBER,
                     NUM_ATTRIB80          NUMBER,
                     NUM_ATTRIB81          NUMBER,
                     NUM_ATTRIB82          NUMBER,
                     NUM_ATTRIB83          NUMBER,
                     NUM_ATTRIB84          NUMBER,
                     NUM_ATTRIB85          NUMBER,
                     DATE_ATTRIB86         DATE,
                     DATE_ATTRIB87         DATE,
                     DATE_ATTRIB88         DATE,
                     DATE_ATTRIB89         DATE,
                     DATE_ATTRIB90         DATE,
                     DATE_ATTRIB91         DATE,
                     DATE_ATTRIB92         DATE,
                     DATE_ATTRIB93         DATE,
                     DATE_ATTRIB94         DATE,
                     DATE_ATTRIB95         DATE,
                     NUM_ATTRIB96          NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB97          NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB98          NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB99          NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB100         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB101         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB102         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB103         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB104         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB105         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB106         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB107         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB108         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB109         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB110         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB111         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB112         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB113         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB114         NUMBER,  /* Added For NM3 */
                     NUM_ATTRIB115         NUMBER,  /* Added For NM3 */
                     ITY_SYS_FLAG          VARCHAR2(1),
                     DET_XSP               VARCHAR2(4))
                     TABLESPACE HHINV_LOAD_3_SPACE;
     break;
  default:
  EXEC SQL CREATE TABLE HHINV_LOAD_3
                    (REC_SEQ_NO            NUMBER(8)     NOT NULL,
                     HE_ID                 NUMBER(8,0)   NOT NULL,
                     LINKCODE              VARCHAR2(10)  NOT NULL,
                     SECTION_CODE          VARCHAR2(5)   NOT NULL,
                     INV_CODE              VARCHAR2(4)   NOT NULL,
                     ATTRIBUTE             VARCHAR2(32)  NOT NULL,
                     ST_CHAIN              NUMBER        NOT NULL,
                     END_CHAIN             NUMBER        NOT NULL,
                     PEO_INVENT_BY_ID      NUMBER(8,0),
                     INVENT_DATE           DATE,
                     X_SECT                VARCHAR2(4),
                     VALUE                 VARCHAR2(500),
                     ERROR_MSG             VARCHAR2(4000),
                     ERROR_FLG             VARCHAR2(1),
                     LENGTH                NUMBER(6),
                     GAP                   NUMBER(6,2),
                     WIDTH                 NUMBER(6,2),
                     HEIGHT                NUMBER(6,2),
                     HEIGHT_2              NUMBER(6,2),
                     DISTANCE              NUMBER(7,2),
                     ANGLE                 NUMBER(6,2),
                     NO_OF_UNITS           NUMBER(3),
                     POWER                 NUMBER(6),
                     TYPE                  VARCHAR2(2),
                     CLASS                 VARCHAR2(2),
                     MATERIAL              VARCHAR2(2),
                     COLOUR                VARCHAR2(2),
                     OWNER                 VARCHAR2(4),
                     METHOD                VARCHAR2(2),
                     OPTIONS               VARCHAR2(2),
                     DESCRIPTION           VARCHAR2(40),
                     ID_CODE               VARCHAR2(8),
                     DIAGRAM               VARCHAR2(6),
                     PHOTO                 VARCHAR2(6),
                     NOTE                  VARCHAR2(40),
                     INSTAL_DATE           DATE,
                     ITEMCODE              VARCHAR2(8),
                     XTRA_CHAR_1           VARCHAR2(20),
                     XTRA_DATE_1           DATE,
                     XTRA_DOMAIN_1         VARCHAR2(2),
                     XTRA_NUMBER_1         NUMBER(10,2),
                     PRIMARY_KEY           VARCHAR2(50),
                     FOREIGN_KEY           VARCHAR2(50),
                     DESCR                 VARCHAR2(40),        /* Added For NM3 */
                     LOCATED_BY            NUMBER(9),           /* Added For NM3 */
                     POSITION              NUMBER,              /* Added For NM3 */
                     X_COORD               NUMBER,              /* Added For NM3 */
                     Y_COORD               NUMBER,              /* Added For NM3 */
                     COORD_FLAG            VARCHAR2(1),         /* Added For NM3 */
                     INV_OWNERSHIP         VARCHAR2(4),         /* Added For NM3 */
                     LCO_LAMP_CONFIG_ID    NUMBER(3),           /* Added For NM3 */
                     OUN_ORG_ID_ELEC_BOARD NUMBER(8),           /* Added For NM3 */
                     PROV_FLAG             VARCHAR2(1),         /* Added For NM3 */
                     REV_BY                VARCHAR2(20),        /* Added For NM3 */
                     REV_DATE              DATE,                /* Added For NM3 */
                     OFFSET                NUMBER,              /* Added For NM3 */
                     X                     NUMBER,              /* Added For NM3 */
                     Y                     NUMBER,              /* Added For NM3 */
                     Z                     NUMBER,              /* Added For NM3 */
                     NUM_ATTRIB16          NUMBER,
                     NUM_ATTRIB17          NUMBER,
                     NUM_ATTRIB18          NUMBER,
                     NUM_ATTRIB19          NUMBER,
                     NUM_ATTRIB20          NUMBER,
                     NUM_ATTRIB21          NUMBER,
                     NUM_ATTRIB22          NUMBER,
                     NUM_ATTRIB23          NUMBER,
                     NUM_ATTRIB24          NUMBER,
                     NUM_ATTRIB25          NUMBER,
                     CHR_ATTRIB27          VARCHAR2(50),
                     CHR_ATTRIB26          VARCHAR2(50),
                     CHR_ATTRIB28          VARCHAR2(50),
                     CHR_ATTRIB29          VARCHAR2(50),
                     CHR_ATTRIB30          VARCHAR2(50),
                     CHR_ATTRIB31          VARCHAR2(50),
                     CHR_ATTRIB32          VARCHAR2(50),
                     CHR_ATTRIB33          VARCHAR2(50),
                     CHR_ATTRIB34          VARCHAR2(50),
                     CHR_ATTRIB35          VARCHAR2(50),
                     CHR_ATTRIB36          VARCHAR2(50),
                     CHR_ATTRIB37          VARCHAR2(50),
                     CHR_ATTRIB38          VARCHAR2(50),
                     CHR_ATTRIB39          VARCHAR2(50),
                     CHR_ATTRIB40          VARCHAR2(50),
                     CHR_ATTRIB41          VARCHAR2(50),
                     CHR_ATTRIB42          VARCHAR2(50),
                     CHR_ATTRIB43          VARCHAR2(50),
                     CHR_ATTRIB44          VARCHAR2(50),
                     CHR_ATTRIB45          VARCHAR2(50),
                     CHR_ATTRIB46          VARCHAR2(50),
                     CHR_ATTRIB47          VARCHAR2(50),
                     CHR_ATTRIB48          VARCHAR2(50),
                     CHR_ATTRIB49          VARCHAR2(50),
                     CHR_ATTRIB50          VARCHAR2(50),
                     CHR_ATTRIB51          VARCHAR2(50),
                     CHR_ATTRIB52          VARCHAR2(50),
                     CHR_ATTRIB53          VARCHAR2(50),
                     CHR_ATTRIB54          VARCHAR2(50),
                     CHR_ATTRIB55          VARCHAR2(50),
                     CHR_ATTRIB56          VARCHAR2(200),
                     CHR_ATTRIB57          VARCHAR2(200),
                     CHR_ATTRIB58          VARCHAR2(200),
                     CHR_ATTRIB59          VARCHAR2(200),
                     CHR_ATTRIB60          VARCHAR2(200),
                     CHR_ATTRIB61          VARCHAR2(200),
                     CHR_ATTRIB62          VARCHAR2(200),
                     CHR_ATTRIB63          VARCHAR2(200),
                     CHR_ATTRIB64          VARCHAR2(200),
                     CHR_ATTRIB65          VARCHAR2(200),
                     CHR_ATTRIB66          VARCHAR2(500),
                     CHR_ATTRIB67          VARCHAR2(500),
                     CHR_ATTRIB68          VARCHAR2(500),
                     CHR_ATTRIB69          VARCHAR2(500),
                     CHR_ATTRIB70          VARCHAR2(500),
                     CHR_ATTRIB71          VARCHAR2(500),
                     CHR_ATTRIB72          VARCHAR2(500),
                     CHR_ATTRIB73          VARCHAR2(500),
                     CHR_ATTRIB74          VARCHAR2(500),
                     CHR_ATTRIB75          VARCHAR2(500),
                     NUM_ATTRIB76          NUMBER,
                     NUM_ATTRIB77          NUMBER,
                     NUM_ATTRIB78          NUMBER,
                     NUM_ATTRIB79          NUMBER,
                     NUM_ATTRIB80          NUMBER,
                     NUM_ATTRIB81          NUMBER,
                     NUM_ATTRIB82          NUMBER,
                     NUM_ATTRIB83          NUMBER,
                     NUM_ATTRIB84          NUMBER,
                     NUM_ATTRIB85          NUMBER,
                     DATE_ATTRIB86         DATE,
                     DATE_ATTRIB87         DATE,
                     DATE_ATTRIB88         DATE,
                     DATE_ATTRIB89         DATE,
                     DATE_ATTRIB90         DATE,
                     DATE_ATTRIB91         DATE,
                     DATE_ATTRIB92         DATE,
                     DATE_ATTRIB93         DATE,
                     DATE_ATTRIB94         DATE,
                     DATE_ATTRIB95         DATE,
                     NUM_ATTRIB96          NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB97          NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB98          NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB99          NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB100         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB101         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB102         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB103         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB104         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB105         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB106         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB107         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB108         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB109         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB110         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB111         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB112         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB113         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB114         NUMBER,          /* Added For NM3 */
                     NUM_ATTRIB115         NUMBER,          /* Added For NM3 */
                     ITY_SYS_FLAG          VARCHAR2(1),
                     DET_XSP               VARCHAR2(4))
                     TABLESPACE HHINV_LOAD_3_SPACE;

  }

  if(sqlca.sqlcode < 0)
    {
    sql_err("dl_lo_3");
    }
  else
    return(SUCCESS);
 } /* dl_lo_3 */




int index_load_3_msg()
  {
  EXEC SQL CREATE INDEX HHINV_LOAD_3_IND_2
               ON HHINV_LOAD_3(ERROR_FLG);
  if(sqlca.sqlcode < 0)
    sql_err("index_load_3_msg(1)");

  EXEC SQL CREATE INDEX HHINV_LOAD_3_IND_3
               ON HHINV_LOAD_3(REC_SEQ_NO);
  if(sqlca.sqlcode < 0)
    sql_err("index_load_3_msg(2)");

  return((sqlca.sqlcode>=0)?SUCCESS:FATAL);
  } /* index_load_3_msg */



int build_index()
/* ***************************************************************************
    This index allows us to check that no duplicat itemcode values have
    created by problems in the first phase
   ************************************************************************* */
 {

  EXEC SQL CREATE UNIQUE INDEX HHINV_LOAD_2_IND_1
           ON     HHINV_LOAD_2 (REC_SEQ_NO);
  EXEC SQL CREATE INDEX HHINV_LOAD_2_IND_2
           ON     HHINV_LOAD_2 ( HE_ID,INV_CODE,ST_CHAIN,END_CHAIN,X_SECT );
  return(SUCCESS);
 }


 /* **********************************************************************
    **********************************************************************
    COMMONLY USED "SUB" FUNCIONS
    **********************************************************************
    ********************************************************************** */



int time_check()
/* ***************************************************************************
     Used to get date and time at various points to log progress
   ***************************************************************************
*/

 {
  EXEC SQL SELECT TO_CHAR(SYSDATE,'DD-MON-YY  -  HH24:MI:SS')
           INTO   :date_time
           FROM   DUAL;
        if (sqlca.sqlcode < 0)
                sql_err("time_check");


  date_time.arr[date_time.len] = '\0';

  return(SUCCESS);
 }


int stat_upd_run_log()
/* *************************************************************************
     Updates run log to say each step completed and commited so can
      restart.
   ************************************************************************* */
 {

  EXEC SQL UPDATE HHINV_RUN_LOG
           SET    RUN_STAT = :cur_run_stat
           WHERE  RUN_NUM = :run_num;

  if (sqlca.sqlcode < 0)
    sql_err("stat_upd_run_log");
  else
      return(SUCCESS);
 }

int c_get_total()
/* *************************************************************************
   Calculate total number of inv item at start of run
   ************************************************************************* */
 {

  EXEC SQL SELECT COUNT('A')
           INTO   :tot_run :tot_run_i
           FROM   HHINV_HOLD_1
           WHERE  REC_TYPE = 'C';

  EXEC SQL SELECT COUNT('A')
           INTO   :A_cards :A_cards_i
           FROM   HHINV_HOLD_1
           WHERE  REC_TYPE = 'A';

  EXEC SQL SELECT COUNT('B')
           INTO   :B_cards :B_cards_i
           FROM   HHINV_HOLD_1
           WHERE  REC_TYPE = 'B';

  EXEC SQL SELECT COUNT('Z')
           INTO   :Z_cards :Z_cards_i
           FROM   HHINV_HOLD_1
           WHERE  REC_TYPE = 'Z';

  if (sqlca.sqlcode < 0)
    sql_err("c_get_total");
  else
      return(SUCCESS);
 }


int ct_1_nw_err()
/* *************************************************************************
   Count Items in ERROR 1
   ************************************************************************* */
 {
  EXEC SQL SELECT COUNT('A')
           INTO   :newerr_1
           FROM   HHINV_ITEM_ERR_1
           WHERE  RUN_NUM = :run_num;

  if (sqlca.sqlcode < 0)
    sql_err("ct_1_nw_er");
  else
      return(SUCCESS);
 }


int ct_2_nw_err()
/* *************************************************************************
   Count Items in ERROR 2
   ************************************************************************* */
 {
  EXEC SQL SELECT COUNT('A')
           INTO   :newerr_2
           FROM   HHINV_ITEM_ERR_2
           WHERE  RUN_NUM = :run_num;

  if (sqlca.sqlcode < 0)
    sql_err("ct_2_nw_err");
  else
      return(SUCCESS);
 }

int ct_3_nw_err()
/* *************************************************************************
   Count Items in ERROR 3
   ************************************************************************* */
 {
/* ARCHANGES2 Start Looking for core dump */
  EXEC SQL WHENEVER sqlerror continue;
  EXEC SQL WHENEVER sqlwarning continue;

  EXEC SQL DECLARE ARTEMP TABLE
      (ecount        number);

  EXEC SQL create table ARTEMP (ecount number);
  EXEC SQL delete from ARTEMP;
  EXEC SQL insert into ARTEMP select count('A') ecount from hhinv_load_3 where error_flg = 'Y';

  EXEC SQL SELECT ecount
    INTO :newerr_3
    FROM ARTEMP;

  if (sqlca.sqlcode < 0)
  {
    sql_err("ct_3_nw_er");
  }
  else
  {
      return(SUCCESS);
  }
/* ARCHANGES2 End Looking for core dump */
 }

commit()
{
  EXEC SQL COMMIT WORK;
  if(sqlca.sqlcode < 0)
    sql_err("commit");
  return((sqlca.sqlcode>=0)?SUCCESS:FATAL);
}
/* getstrs
   returns the no of strings found (seperator = ',') in line
   input line
   output args - array of char pointers to line
   effects truncates line by inserting a 0 at pos of first comma
*/
int getstrs( line, args )
char *line,*args[];
{ int noargs=0,i;
 char *strchr(),*l;

while( line!= NULL && *line != '\0' ) {
    args[noargs++]=line;
    line=strchr(line,',');
    if( line != NULL ) *line++ = '\0';
    }
for(i=0;i<noargs;i++) /* take off training spaces */
    for(l=args[i], l+=strlen(l)-1 ; *l == ' ' ; *l-- = '\0');

return(noargs);
}

